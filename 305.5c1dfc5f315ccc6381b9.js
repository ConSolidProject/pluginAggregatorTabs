(self.webpackChunktabs=self.webpackChunktabs||[]).push([[305],{60991:(e,t,r)=>{"use strict";r.r(t),r.d(t,{CompactEncrypt:()=>Ae,CompactSign:()=>Ne,EmbeddedJWK:()=>Pe,EncryptJWT:()=>Qe,FlattenedEncrypt:()=>be,FlattenedSign:()=>De,GeneralSign:()=>Le,JOSEAlgNotAllowed:()=>i,JOSEError:()=>n,JOSENotSupported:()=>s,JWEDecryptionFailed:()=>a,JWEInvalid:()=>c,JWKInvalid:()=>l,JWKSInvalid:()=>p,JWKSMultipleMatchingKeys:()=>y,JWKSNoMatchingKey:()=>h,JWSInvalid:()=>d,JWSSignatureVerificationFailed:()=>f,JWTClaimValidationFailed:()=>o,JWTExpired:()=>g,JWTInvalid:()=>u,SignJWT:()=>Ze,UnsecuredJWT:()=>et,base64UrlDecode:()=>nt,base64UrlEncode:()=>rt,calculateThumbprint:()=>ke,compactDecrypt:()=>me,compactVerify:()=>xe,createRemoteJWKSet:()=>Ce,decodeProtectedHeader:()=>ot,flattenedDecrypt:()=>we,flattenedVerify:()=>je,fromKeyLike:()=>Se,generalDecrypt:()=>Ie,generalVerify:()=>$e,generateKeyPair:()=>st,generateSecret:()=>at,jwtDecrypt:()=>Xe,jwtVerify:()=>tt,parseJwk:()=>ae,random:()=>ct});class n extends Error{constructor(e){super(e),this.code=n.code,this.name=this.constructor.name,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}n.code="ERR_JOSE_GENERIC";class o extends n{constructor(e,t="unspecified",r="unspecified"){super(e),this.code=o.code,this.claim=t,this.reason=r}}o.code="ERR_JWT_CLAIM_VALIDATION_FAILED";class i extends n{constructor(){super(...arguments),this.code=i.code}}i.code="ERR_JOSE_ALG_NOT_ALLOWED";class s extends n{constructor(){super(...arguments),this.code=s.code}}s.code="ERR_JOSE_NOT_SUPPORTED";class a extends n{constructor(){super(...arguments),this.code=a.code,this.message="decryption operation failed"}}a.code="ERR_JWE_DECRYPTION_FAILED";class c extends n{constructor(){super(...arguments),this.code=c.code}}c.code="ERR_JWE_INVALID";class d extends n{constructor(){super(...arguments),this.code=d.code}}d.code="ERR_JWS_INVALID";class u extends n{constructor(){super(...arguments),this.code=u.code}}u.code="ERR_JWT_INVALID";class l extends n{constructor(){super(...arguments),this.code=l.code}}l.code="ERR_JWK_INVALID";class p extends n{constructor(){super(...arguments),this.code=p.code}}p.code="ERR_JWKS_INVALID";class h extends n{constructor(){super(...arguments),this.code=h.code,this.message="no applicable key found in the JSON Web Key Set"}}h.code="ERR_JWKS_NO_MATCHING_KEY";class y extends n{constructor(){super(...arguments),this.code=y.code,this.message="multiple matching keys found in the JSON Web Key Set"}}y.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";class f extends n{constructor(){super(...arguments),this.code=f.code,this.message="signature verification failed"}}f.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";class g extends o{constructor(){super(...arguments),this.code=g.code}}g.code="ERR_JWT_EXPIRED";const w=(...e)=>{const t=e.filter(Boolean);if(0===t.length||1===t.length)return!0;let r;for(const e of t){const t=Object.keys(e);if(r&&0!==r.size)for(const e of t){if(r.has(e))return!1;r.add(e)}else r=new Set(t)}return!0};function m(e){if("object"!=typeof(t=e)||null===t||"[object Object]"!==Object.prototype.toString.call(e))return!1;var t;if(null===Object.getPrototypeOf(e))return!0;let r=e;for(;null!==Object.getPrototypeOf(r);)r=Object.getPrototypeOf(r);return Object.getPrototypeOf(e)===r}const S=new TextEncoder,v=new TextDecoder,E=2**32;function _(...e){const t=e.reduce(((e,{length:t})=>e+t),0),r=new Uint8Array(t);let n=0;return e.forEach((e=>{r.set(e,n),n+=e.length})),r}function b(e,t){return _(S.encode(e),new Uint8Array([0]),t)}function A(e,t,r){if(t<0||t>=E)throw new RangeError(`value must be >= 0 and <= 4294967295. Received ${t}`);e.set([t>>>24,t>>>16,t>>>8,255&t],r)}function I(e){const t=Math.floor(e/E),r=e%E,n=new Uint8Array(8);return A(n,t,0),A(n,r,4),n}function P(e){const t=new Uint8Array(4);return A(t,e),t}function U(e){return _(P(e.length),e)}var k=function(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;throw new Error("unable to locate global object")}();const T=e=>{let t=e;"string"==typeof t&&(t=S.encode(t));const r=[];for(let e=0;e<t.length;e+=32768)r.push(String.fromCharCode.apply(null,t.subarray(e,e+32768)));return k.btoa(r.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},R=e=>{let t=e;t instanceof Uint8Array&&(t=v.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return new Uint8Array(k.atob(t).split("").map((e=>e.charCodeAt(0))))}catch(e){throw new TypeError("The input to be decoded is not correctly encoded.")}},C=new Map([["A128CBC-HS256",128],["A128GCM",96],["A128GCMKW",96],["A192CBC-HS384",128],["A192GCM",96],["A192GCMKW",96],["A256CBC-HS512",128],["A256GCM",96],["A256GCMKW",96]]),O=e=>t=>{const r=C.get(t);if(!r)throw new s(`Unsupported JWE Algorithm: ${t}`);return e(new Uint8Array(r>>3))},H=(e,t)=>{if(t.length<<3!==C.get(e))throw new c("Invalid Initialization Vector length")};var K=k.crypto;function D(e){return void 0!==k.CryptoKey&&null!=e&&e instanceof k.CryptoKey}const N=(e,t)=>{let r;switch(e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":if(r=parseInt(e.substr(-3),10),!(t instanceof Uint8Array))throw new TypeError(`${e} content encryption requires Uint8Array as key input`);break;case"A128GCM":case"A192GCM":case"A256GCM":r=parseInt(e.substr(1,3),10);break;default:throw new s(`Content Encryption Algorithm ${e} is not supported either by JOSE or your javascript runtime`)}if(t instanceof Uint8Array){if(t.length<<3!==r)throw new c("Invalid Content Encryption Key length")}else{if(!D(t))throw new TypeError("Invalid Content Encryption Key type");{const{length:e}=t.algorithm;if(e!==r)throw new c("Invalid Content Encryption Key length")}}};var M=(e,...t)=>{let r="Key must be ";if(t.length>2){const e=t.pop();r+=`one of type ${t.join(", ")}, or ${e}.`}else 2===t.length?r+=`one of type ${t[0]} or ${t[1]}.`:r+=`of type ${t[0]}.`;return null==e?r+=` Received ${e}`:"function"==typeof e&&e.name?r+=` Received function ${e.name}`:"object"==typeof e&&null!=e&&e.constructor&&e.constructor.name&&(r+=` Received an instance of ${e.constructor.name}`),r};const W=async(e,t,r,n,o,i)=>{if(!(D(t)||t instanceof Uint8Array))throw new TypeError(M(t,"CryptoKey","Uint8Array"));switch(N(e,t),H(e,n),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return async function(e,t,r,n,o,i){const s=parseInt(e.substr(1,3),10),c=await K.subtle.importKey("raw",t.subarray(s>>3),"AES-CBC",!1,["decrypt"]),d=await K.subtle.importKey("raw",t.subarray(0,s>>3),{hash:{name:"SHA-"+(s<<1)},name:"HMAC"},!1,["sign"]),u=_(i,n,r,I(i.length<<3)),l=new Uint8Array((await K.subtle.sign("HMAC",d,u)).slice(0,s>>3));let p,h;try{p=((e,t)=>{if(!(e instanceof Uint8Array))throw new TypeError("First argument must be a buffer");if(!(t instanceof Uint8Array))throw new TypeError("Second argument must be a buffer");if(e.length!==t.length)throw new TypeError("Input buffers must have the same length");const r=e.length;let n=0,o=-1;for(;++o<r;)n|=e[o]^t[o];return 0===n})(o,l)}catch(e){}if(!p)throw new a;try{h=new Uint8Array(await K.subtle.decrypt({iv:n,name:"AES-CBC"},c,r))}catch(e){}if(!h)throw new a;return h}(e,t,r,n,o,i);case"A128GCM":case"A192GCM":case"A256GCM":return async function(e,t,r,n,o){const i=e instanceof Uint8Array?await K.subtle.importKey("raw",e,"AES-GCM",!1,["decrypt"]):e;try{return new Uint8Array(await K.subtle.decrypt({additionalData:o,iv:r,name:"AES-GCM",tagLength:128},i,_(t,n)))}catch(e){throw new a}}(t,r,n,o,i);default:throw new s("unsupported JWE Content Encryption Algorithm")}},j=async()=>{throw new s('JWE "zip" (Compression Algorithm) Header Parameter is not supported by your javascript runtime. You need to use the `inflateRaw` decrypt option to provide Inflate Raw implementation, e.g. using the "pako" module.')},x=async()=>{throw new s('JWE "zip" (Compression Algorithm) Header Parameter is not supported by your javascript runtime.')},F=[{hash:{name:"SHA-256"},name:"HMAC"},!0,["sign"]];function J(e,t){if(e.algorithm.length!==parseInt(t.substr(1,3),10))throw new TypeError(`invalid key size for alg: ${t}`)}function L(e,t){if(D(e))return e;if(e instanceof Uint8Array)return K.subtle.importKey("raw",e,"AES-KW",!0,[t]);throw new TypeError(M(e,"CryptoKey","Uint8Array"))}const $=async(e,t,r)=>{const n=await L(t,"wrapKey");J(n,e);const o=await K.subtle.importKey("raw",r,...F);return new Uint8Array(await K.subtle.wrapKey("raw",o,n,"AES-KW"))},B=async(e,t,r)=>{const n=await L(t,"unwrapKey");J(n,e);const o=await K.subtle.unwrapKey("raw",r,n,"AES-KW",...F);return new Uint8Array(await K.subtle.exportKey("raw",o))},V=async(e,t)=>{const r=`SHA-${e.substr(-3)}`;return new Uint8Array(await K.subtle.digest(r,t))},G=async(e,t,r,n,o=new Uint8Array(0),i=new Uint8Array(0))=>{if(!D(e))throw new TypeError(M(e,"CryptoKey"));if(!D(t))throw new TypeError(M(t,"CryptoKey"));const s=_(U(S.encode(r)),U(o),U(i),P(n));if(!t.usages.includes("deriveBits"))throw new TypeError('ECDH-ES private key "usages" must include "deriveBits"');const a=new Uint8Array(await K.subtle.deriveBits({name:"ECDH",public:e},t,Math.ceil(parseInt(t.algorithm.namedCurve.substr(-3),10)/8)<<3));return async function(e,t,r,n){const o=Math.ceil((r>>3)/32);let i;for(let r=1;r<=o;r++){const o=new Uint8Array(4+t.length+n.length);o.set(P(r)),o.set(t,4),o.set(n,4+t.length),i=i?_(i,await e("sha256",o)):await e("sha256",o)}return i=i.slice(0,r>>3),i}(V,a,n,s)},q=e=>{if(!D(e))throw new TypeError(M(e,"CryptoKey"));return["P-256","P-384","P-521"].includes(e.algorithm.namedCurve)},z=K.getRandomValues.bind(K);function X(e){if(!(e instanceof Uint8Array)||e.length<8)throw new c("PBES2 Salt Input must be 8 or more octets")}function Y(e){if(e instanceof Uint8Array)return K.subtle.importKey("raw",e,"PBKDF2",!1,["deriveBits"]);if(D(e))return e;throw new TypeError(M(e,"CryptoKey","Uint8Array"))}const Q=async(e,t,r,n=Math.floor(2049*Math.random())+2048,o=z(new Uint8Array(16)))=>{X(o);const i=b(e,o),s=parseInt(e.substr(13,3),10),a={hash:{name:`SHA-${e.substr(8,3)}`},iterations:n,name:"PBKDF2",salt:i},c={length:s,name:"AES-KW"},d=await Y(t);let u;if(d.usages.includes("deriveBits"))u=new Uint8Array(await K.subtle.deriveBits(a,d,s));else{if(!d.usages.includes("deriveKey"))throw new TypeError('PBKDF2 key "usages" must include "deriveBits" or "deriveKey"');u=await K.subtle.deriveKey(a,d,c,!1,["wrapKey"])}return{encryptedKey:await $(e.substr(-6),u,r),p2c:n,p2s:T(o)}},Z=async(e,t,r,n,o)=>{X(o);const i=b(e,o),s=parseInt(e.substr(13,3),10),a={hash:{name:`SHA-${e.substr(8,3)}`},iterations:n,name:"PBKDF2",salt:i},c={length:s,name:"AES-KW"},d=await Y(t);let u;if(d.usages.includes("deriveBits"))u=new Uint8Array(await K.subtle.deriveBits(a,d,s));else{if(!d.usages.includes("deriveKey"))throw new TypeError('PBKDF2 key "usages" must include "deriveBits" or "deriveKey"');u=await K.subtle.deriveKey(a,d,c,!1,["unwrapKey"])}return B(e.substr(-6),u,r)};function ee(e){switch(e){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new s(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}var te=(e,t)=>{if(e.startsWith("HS")){const r=parseInt(e.substr(-3),10),{length:n}=t.algorithm;if("number"!=typeof n||n<r)throw new TypeError(`${e} requires symmetric keys to be ${r} bits or larger`)}if(e.startsWith("RS")||e.startsWith("PS")){const{modulusLength:r}=t.algorithm;if("number"!=typeof r||r<2048)throw new TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}};const re=async(e,t,r,n,o)=>{if(!(D(r)||r instanceof Uint8Array))throw new TypeError(M(r,"CryptoKey","Uint8Array"));switch(N(e,r),H(e,n),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return async function(e,t,r,n,o){const i=parseInt(e.substr(1,3),10),s=await K.subtle.importKey("raw",r.subarray(i>>3),"AES-CBC",!1,["encrypt"]),a=await K.subtle.importKey("raw",r.subarray(0,i>>3),{hash:{name:"SHA-"+(i<<1)},name:"HMAC"},!1,["sign"]),c=new Uint8Array(await K.subtle.encrypt({iv:n,name:"AES-CBC"},s,t)),d=_(o,n,c,I(o.length<<3));return{ciphertext:c,tag:new Uint8Array((await K.subtle.sign("HMAC",a,d)).slice(0,i>>3))}}(e,t,r,n,o);case"A128GCM":case"A192GCM":case"A256GCM":return async function(e,t,r,n){const o=t instanceof Uint8Array?await K.subtle.importKey("raw",t,"AES-GCM",!1,["encrypt"]):t,i=new Uint8Array(await K.subtle.encrypt({additionalData:n,iv:r,name:"AES-GCM",tagLength:128},o,e)),s=i.slice(-16);return{ciphertext:i.slice(0,-16),tag:s}}(t,r,n,o);default:throw new s("unsupported JWE Content Encryption Algorithm")}},ne=O(z),oe=new Map([["A128CBC-HS256",256],["A128GCM",128],["A192CBC-HS384",384],["A192GCM",192],["A256CBC-HS512",512],["A256GCM",256]]),ie=e=>t=>{const r=oe.get(t);if(!r)throw new s(`Unsupported JWE Algorithm: ${t}`);return e(new Uint8Array(r>>3))},se=async e=>{var t,r;const{algorithm:n,keyUsages:o}=function(e){let t,r;switch(e.kty){case"oct":switch(e.alg){case"HS256":case"HS384":case"HS512":t={name:"HMAC",hash:{name:`SHA-${e.alg.substr(-3)}`}},r=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":throw new s(`${e.alg} keys cannot be imported as CryptoKey instances`);case"A128GCM":case"A192GCM":case"A256GCM":case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":t={name:"AES-GCM"},r=["encrypt","decrypt"];break;case"A128KW":case"A192KW":case"A256KW":t={name:"AES-KW"},r=["wrapKey","unwrapKey"];break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":t={name:"PBKDF2"},r=["deriveBits"];break;default:throw new s('unsupported or invalid JWK "alg" (Algorithm) Parameter value')}break;case"RSA":switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:{name:`SHA-${e.alg.substr(-3)}`}},r=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:{name:`SHA-${e.alg.substr(-3)}`}},r=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:{name:`SHA-${parseInt(e.alg.substr(-3),10)||1}`}},r=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new s('unsupported or invalid JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(e.alg){case"ES256":case"ES384":case"ES512":t={name:"ECDSA",namedCurve:e.crv},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new s('unsupported or invalid JWK "alg" (Algorithm) Parameter value')}break;default:throw new s('unsupported or invalid JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:r}}(e);let i="jwk",a={...e};return delete a.alg,"PBKDF2"===n.name&&(i="raw",a=R(e.k)),K.subtle.importKey(i,a,n,null!==(t=e.ext)&&void 0!==t&&t,null!==(r=e.key_ops)&&void 0!==r?r:o)};async function ae(e,t,r){if(!m(e))throw new TypeError("JWK must be an object");if(t||(t=e.alg),"string"!=typeof t||!t)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');switch(e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw new TypeError('missing "k" (Key Value) Parameter value');return null!=r||(r=!0!==e.ext),r?se({...e,alg:t,ext:!1}):R(e.k);case"RSA":if(void 0!==e.oth)throw new s('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return se({...e,alg:t});default:throw new s('unsupported "kty" (Key Type) Parameter value')}}const ce=(e,t,r)=>{if(!(t instanceof Uint8Array||(null==t?void 0:t.type)))throw new TypeError(M(t,"KeyObject","CryptoKey","Uint8Array"));if(e.startsWith("HS")||"dir"===e||e.startsWith("PBES2")||e.match(/^A\d{3}(?:GCM)?KW$/)){if(t instanceof Uint8Array||"secret"===t.type)return;throw new TypeError('CryptoKey or KeyObject instances for symmetric algorithms must be of type "secret"')}if(t instanceof Uint8Array)throw new TypeError(M(t,"KeyObject","CryptoKey"));if("secret"===t.type)throw new TypeError('CryptoKey or KeyObject instances for asymmetric algorithms must not be of type "secret"');if("sign"===r&&"public"===t.type)throw new TypeError('CryptoKey or KeyObject instances for asymmetric algorithm signing must be of type "private"');if("decrypt"===r&&"public"===t.type)throw new TypeError('CryptoKey or KeyObject instances for asymmetric algorithm decryption must be of type "private"')};function de(e){if(!e)throw new c("JWE Encrypted Key missing")}function ue(e,t,r){if(void 0===e[t])throw new c(`JOSE Header ${r} (${t}) missing`)}function le(e,t,r,n,o){if(void 0!==o.crit&&void 0===n.crit)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||void 0===n.crit)return new Set;if(!Array.isArray(n.crit)||0===n.crit.length||n.crit.some((e=>"string"!=typeof e||0===e.length)))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let i;i=void 0!==r?new Map([...Object.entries(r),...t.entries()]):t;for(const t of n.crit){if(!i.has(t))throw new s(`Extension Header Parameter "${t}" is not recognized`);if(void 0===o[t])throw new e(`Extension Header Parameter "${t}" is missing`);if(i.get(t)&&void 0===n[t])throw new e(`Extension Header Parameter "${t}" MUST be integrity protected`)}return new Set(n.crit)}const pe=(e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some((e=>"string"!=typeof e))))throw new TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)},he=ie(z),ye=le.bind(void 0,c,new Map),fe=pe.bind(void 0,"keyManagementAlgorithms"),ge=pe.bind(void 0,"contentEncryptionAlgorithms");async function we(e,t,r){var n;if(!m(e))throw new c("Flattened JWE must be an object");if(void 0===e.protected&&void 0===e.header&&void 0===e.unprotected)throw new c("JOSE Header missing");if("string"!=typeof e.iv)throw new c("JWE Initialization Vector missing or incorrect type");if("string"!=typeof e.ciphertext)throw new c("JWE Ciphertext missing or incorrect type");if("string"!=typeof e.tag)throw new c("JWE Authentication Tag missing or incorrect type");if(void 0!==e.protected&&"string"!=typeof e.protected)throw new c("JWE Protected Header incorrect type");if(void 0!==e.encrypted_key&&"string"!=typeof e.encrypted_key)throw new c("JWE Encrypted Key incorrect type");if(void 0!==e.aad&&"string"!=typeof e.aad)throw new c("JWE AAD incorrect type");if(void 0!==e.header&&!m(e.header))throw new c("JWE Shared Unprotected Header incorrect type");if(void 0!==e.unprotected&&!m(e.unprotected))throw new c("JWE Per-Recipient Unprotected Header incorrect type");let o;if(e.protected){const t=R(e.protected);try{o=JSON.parse(v.decode(t))}catch(e){throw new c("JWE Protected Header is invalid")}}if(!w(o,e.header,e.unprotected))throw new c("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");const a={...o,...e.header,...e.unprotected};if(ye(null==r?void 0:r.crit,o,a),void 0!==a.zip){if(!o||!o.zip)throw new c('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if("DEF"!==a.zip)throw new s('unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}const{alg:d,enc:u}=a;if("string"!=typeof d||!d)throw new c("missing JWE Algorithm (alg) in JWE Header");if("string"!=typeof u||!u)throw new c("missing JWE Encryption Algorithm (enc) in JWE Header");const l=r&&fe(r.keyManagementAlgorithms),p=r&&ge(r.contentEncryptionAlgorithms);if(l&&!l.has(d))throw new i('"alg" (Algorithm) Header Parameter not allowed');if(p&&!p.has(u))throw new i('"enc" (Encryption Algorithm) Header Parameter not allowed');let h,y;void 0!==e.encrypted_key&&(h=R(e.encrypted_key)),"function"==typeof t&&(t=await t(o,e));try{y=await async function(e,t,r,n){switch(ce(e,t,"decrypt"),e){case"dir":if(void 0!==r)throw new c("Encountered unexpected JWE Encrypted Key");return t;case"ECDH-ES":if(void 0!==r)throw new c("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(ue(n,"epk","Ephemeral Public Key"),!q(t))throw new s("ECDH-ES with the provided key is not allowed or not supported by your javascript runtime");const o=await ae(n.epk,e);let i,a;void 0!==n.apu&&(i=R(n.apu)),void 0!==n.apv&&(a=R(n.apv));const c=await G(o,t,"ECDH-ES"===e?n.enc:e,parseInt(e.substr(-5,3),10)||oe.get(n.enc),i,a);if("ECDH-ES"===e)return c;de(r);const d=e.substr(-6);return B(d,c,r)}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return de(r),(async(e,t,r)=>{if(!D(t))throw new TypeError(M(t,"CryptoKey"));if(te(e,t),t.usages.includes("decrypt"))return new Uint8Array(await K.subtle.decrypt(ee(e),t,r));if(t.usages.includes("unwrapKey")){const n=await K.subtle.unwrapKey("raw",r,t,ee(e),...F);return new Uint8Array(await K.subtle.exportKey("raw",n))}throw new TypeError('RSA-OAEP key "usages" must include "decrypt" or "unwrapKey" for this operation')})(e,t,r);case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{de(r),ue(n,"p2c","PBES2 Count"),ue(n,"p2s","PBES2 Salt");const{p2c:o}=n,i=R(n.p2s);return Z(e,t,r,o,i)}case"A128KW":case"A192KW":case"A256KW":return de(r),B(e,t,r);case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":return de(r),ue(n,"iv","Initialization Vector"),ue(n,"tag","Authentication Tag"),(async(e,t,r,n,o)=>{const i=e.substr(0,7);return W(i,t,r,n,o,new Uint8Array(0))})(e,t,r,R(n.iv),R(n.tag));default:throw new s('unsupported or invalid "alg" (JWE Algorithm) header value')}}(d,t,h,a)}catch(e){if(e instanceof TypeError)throw e;y=he(u)}const f=R(e.iv),g=R(e.tag),E=S.encode(null!==(n=e.protected)&&void 0!==n?n:"");let b;b=void 0!==e.aad?_(E,S.encode("."),S.encode(e.aad)):E;let A=await W(u,y,R(e.ciphertext),f,g,b);"DEF"===a.zip&&(A=await((null==r?void 0:r.inflateRaw)||j)(A));const I={plaintext:A};return void 0!==e.protected&&(I.protectedHeader=o),void 0!==e.aad&&(I.additionalAuthenticatedData=R(e.aad)),void 0!==e.unprotected&&(I.sharedUnprotectedHeader=e.unprotected),void 0!==e.header&&(I.unprotectedHeader=e.header),I}async function me(e,t,r){if(e instanceof Uint8Array&&(e=v.decode(e)),"string"!=typeof e)throw new c("Compact JWE must be a string or Uint8Array");const{0:n,1:o,2:i,3:s,4:a,length:d}=e.split(".");if(5!==d)throw new c("Invalid Compact JWE");const u=await we({ciphertext:s||void 0,iv:i||void 0,protected:n||void 0,tag:a||void 0,encrypted_key:o||void 0},t,r);return{plaintext:u.plaintext,protectedHeader:u.protectedHeader}}async function Se(e){return(async e=>{if(e instanceof Uint8Array)return{kty:"oct",k:T(e)};if(!D(e))throw new TypeError(M(e,"CryptoKey","Uint8Array"));if(!e.extractable)throw new TypeError("non-extractable CryptoKey cannot be exported as a JWK");const{ext:t,key_ops:r,alg:n,use:o,...i}=await K.subtle.exportKey("jwk",e);return i})(e)}const ve=ie(z);const Ee=O(z),_e=le.bind(void 0,c,new Map);class be{constructor(e){this._plaintext=e}setKeyManagementParameters(e){if(this._keyManagementParameters)throw new TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setSharedUnprotectedHeader(e){if(this._sharedUnprotectedHeader)throw new TypeError("setSharedUnprotectedHeader can only be called once");return this._sharedUnprotectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}setAdditionalAuthenticatedData(e){return this._aad=e,this}setContentEncryptionKey(e){if(this._cek)throw new TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw new TypeError("setInitializationVector can only be called once");return this._iv=e,this}async encrypt(e,t){if(!this._protectedHeader&&!this._unprotectedHeader&&!this._sharedUnprotectedHeader)throw new c("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!w(this._protectedHeader,this._unprotectedHeader,this._sharedUnprotectedHeader))throw new c("JWE Shared Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");const r={...this._protectedHeader,...this._unprotectedHeader,...this._sharedUnprotectedHeader};if(_e(null==t?void 0:t.crit,this._protectedHeader,r),void 0!==r.zip){if(!this._protectedHeader||!this._protectedHeader.zip)throw new c('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if("DEF"!==r.zip)throw new s('unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}const{alg:n,enc:o}=r;if("string"!=typeof n||!n)throw new c('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("string"!=typeof o||!o)throw new c('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');let i,a,d,u,l,p,h;if("dir"===n){if(this._cek)throw new TypeError("setContentEncryptionKey cannot be called when using Direct Encryption")}else if("ECDH-ES"===n&&this._cek)throw new TypeError("setContentEncryptionKey cannot be called when using Direct Key Agreement");{let t;({cek:a,encryptedKey:i,parameters:t}=await async function(e,t,r,n,o={}){let i,a,c;switch(ce(e,r,"encrypt"),e){case"dir":c=r;break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!q(r))throw new s("ECDH-ES with the provided key is not allowed or not supported by your javascript runtime");const{apu:d,apv:u}=o;let{epk:l}=o;l||(l=await(async e=>{if(!D(e))throw new TypeError(M(e,"CryptoKey"));return(await K.subtle.generateKey({name:"ECDH",namedCurve:e.algorithm.namedCurve},!0,["deriveBits"])).privateKey})(r));const{x:p,y:h,crv:y,kty:f}=await Se(l),g=await G(r,l,"ECDH-ES"===e?t:e,parseInt(e.substr(-5,3),10)||oe.get(t),d,u);if(a={epk:{x:p,y:h,crv:y,kty:f}},d&&(a.apu=T(d)),u&&(a.apv=T(u)),"ECDH-ES"===e){c=g;break}c=n||ve(t);const w=e.substr(-6);i=await $(w,g,c);break}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":c=n||ve(t),i=await(async(e,t,r)=>{if(!D(t))throw new TypeError(M(t,"CryptoKey"));if(te(e,t),t.usages.includes("encrypt"))return new Uint8Array(await K.subtle.encrypt(ee(e),t,r));if(t.usages.includes("wrapKey")){const n=await K.subtle.importKey("raw",r,...F);return new Uint8Array(await K.subtle.wrapKey("raw",n,t,ee(e)))}throw new TypeError('RSA-OAEP key "usages" must include "encrypt" or "wrapKey" for this operation')})(e,r,c);break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{c=n||ve(t);const{p2c:s,p2s:d}=o;({encryptedKey:i,...a}=await Q(e,r,c,s,d));break}case"A128KW":case"A192KW":case"A256KW":c=n||ve(t),i=await $(e,r,c);break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{c=n||ve(t);const{iv:s}=o;({encryptedKey:i,...a}=await(async(e,t,r,n)=>{const o=e.substr(0,7);n||(n=ne(o));const{ciphertext:i,tag:s}=await re(o,r,t,n,new Uint8Array(0));return{encryptedKey:i,iv:T(n),tag:T(s)}})(e,r,c,s));break}default:throw new s('unsupported or invalid "alg" (JWE Algorithm) header value')}return{cek:c,encryptedKey:i,parameters:a}}(n,o,e,this._cek,this._keyManagementParameters)),t&&(this._protectedHeader?this._protectedHeader={...this._protectedHeader,...t}:this.setProtectedHeader(t))}if(this._iv||(this._iv=Ee(o)),u=this._protectedHeader?S.encode(T(JSON.stringify(this._protectedHeader))):S.encode(""),this._aad?(l=T(this._aad),d=_(u,S.encode("."),S.encode(l))):d=u,"DEF"===r.zip){const e=await((null==t?void 0:t.deflateRaw)||x)(this._plaintext);({ciphertext:p,tag:h}=await re(o,e,a,this._iv,d))}else({ciphertext:p,tag:h}=await re(o,this._plaintext,a,this._iv,d));const y={ciphertext:T(p),iv:T(this._iv),tag:T(h)};return i&&(y.encrypted_key=T(i)),l&&(y.aad=l),this._protectedHeader&&(y.protected=v.decode(u)),this._sharedUnprotectedHeader&&(y.unprotected=this._sharedUnprotectedHeader),this._unprotectedHeader&&(y.header=this._unprotectedHeader),y}}class Ae{constructor(e){this._flattened=new be(e)}setContentEncryptionKey(e){return this._flattened.setContentEncryptionKey(e),this}setInitializationVector(e){return this._flattened.setInitializationVector(e),this}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}setKeyManagementParameters(e){return this._flattened.setKeyManagementParameters(e),this}async encrypt(e,t){const r=await this._flattened.encrypt(e,t);return[r.protected,r.encrypted_key,r.iv,r.ciphertext,r.tag].join(".")}}async function Ie(e,t,r){if(!m(e))throw new c("General JWE must be an object");if(!Array.isArray(e.recipients)||!e.recipients.every(m))throw new c("JWE Recipients missing or incorrect type");for(const n of e.recipients)try{return await we({aad:e.aad,ciphertext:e.ciphertext,encrypted_key:n.encrypted_key,header:n.header,iv:e.iv,protected:e.protected,tag:e.tag,unprotected:e.unprotected},t,r)}catch(e){}throw new a}async function Pe(e,t){const r={...e,...t.header};if(!m(r.jwk))throw new d('"jwk" (JSON Web Key) Header Parameter must be a JSON object');const n=await ae(r.jwk,r.alg,!0);if("public"!==n.type)throw new d('"jwk" (JSON Web Key) Header Parameter must be a public key');return n}const Ue=(e,t)=>{if("string"!=typeof e||!e)throw new l(`${t} missing or invalid`)};async function ke(e,t="sha256"){if(!m(e))throw new TypeError("JWK must be an object");let r;switch(e.kty){case"EC":Ue(e.crv,'"crv" (Curve) Parameter'),Ue(e.x,'"x" (X Coordinate) Parameter'),Ue(e.y,'"y" (Y Coordinate) Parameter'),r={crv:e.crv,kty:e.kty,x:e.x,y:e.y};break;case"OKP":Ue(e.crv,'"crv" (Subtype of Key Pair) Parameter'),Ue(e.x,'"x" (Public Key) Parameter'),r={crv:e.crv,kty:e.kty,x:e.x};break;case"RSA":Ue(e.e,'"e" (Exponent) Parameter'),Ue(e.n,'"n" (Modulus) Parameter'),r={e:e.e,kty:e.kty,n:e.n};break;case"oct":Ue(e.k,'"k" (Key Value) Parameter'),r={k:e.k,kty:e.kty};break;default:throw new s('"kty" (Key Type) Parameter missing or unsupported')}const n=S.encode(JSON.stringify(r));return T(await V(t,n))}function Te(e){return m(e)}class Re{constructor(e,t){if(this._cached=new WeakMap,!(e instanceof URL))throw new TypeError("url must be an instance of URL");this._url=new URL(e.href),this._options={agent:null==t?void 0:t.agent},this._timeoutDuration="number"==typeof(null==t?void 0:t.timeoutDuration)?null==t?void 0:t.timeoutDuration:5e3,this._cooldownDuration="number"==typeof(null==t?void 0:t.cooldownDuration)?null==t?void 0:t.cooldownDuration:3e4}coolingDown(){return void 0!==this._cooldownStarted&&Date.now()<this._cooldownStarted+this._cooldownDuration}async getKey(e){this._jwks||await this.reload();const t=this._jwks.keys.filter((t=>{let r=t.kty===function(e){switch(e.substr(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new s('Unsupported "alg" value for a JSON Web Key Set')}}(e.alg);if(r&&"string"==typeof e.kid&&(r=e.kid===t.kid),r&&"string"==typeof t.alg&&(r=e.alg===t.alg),r&&"string"==typeof t.use&&(r="sig"===t.use),r&&Array.isArray(t.key_ops)&&(r=t.key_ops.includes("verify")),r&&"EdDSA"===e.alg&&(r=["Ed25519","Ed448"].includes(t.crv)),r)switch(e.alg){case"ES256":r="P-256"===t.crv;break;case"ES256K":r="secp256k1"===t.crv;break;case"ES384":r="P-384"===t.crv;break;case"ES512":r="P-521"===t.crv}return r})),{0:r,length:n}=t;if(0===n){if(!1===this.coolingDown())return await this.reload(),this.getKey(e);throw new h}if(1!==n)throw new y;this._cached.has(r)||this._cached.set(r,{});const o=this._cached.get(r);if(void 0===o[e.alg]){const t=await ae({...r,alg:e.alg});if("public"!==t.type)throw new p("JSON Web Key Set members must be public keys");o[e.alg]=t}return o[e.alg]}async reload(){this._pendingFetch||(this._pendingFetch=(async(e,t)=>{let r;"function"==typeof AbortController&&(r=new AbortController,setTimeout((()=>r.abort()),t));const o=await k.fetch(e.href,{signal:r?r.signal:void 0,redirect:"manual",referrerPolicy:"no-referrer",credentials:"omit",mode:"cors",method:"GET"});if(200!==o.status)throw new n("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await o.json()}catch(e){throw new n("Failed to parse the JSON Web Key Set HTTP response as JSON")}})(this._url,this._timeoutDuration,this._options).then((e=>{if("object"!=typeof e||!e||!Array.isArray(e.keys)||!e.keys.every(Te))throw new p("JSON Web Key Set malformed");this._jwks={keys:e.keys},this._cooldownStarted=Date.now(),this._pendingFetch=void 0})).catch((e=>{throw this._pendingFetch=void 0,e}))),await this._pendingFetch}}function Ce(e,t){const r=new Re(e,t);return r.getKey.bind(r)}function Oe(e){switch(e){case"HS256":return{hash:{name:"SHA-256"},name:"HMAC"};case"HS384":return{hash:{name:"SHA-384"},name:"HMAC"};case"HS512":return{hash:{name:"SHA-512"},name:"HMAC"};case"PS256":return{hash:{name:"SHA-256"},name:"RSA-PSS",saltLength:32};case"PS384":return{hash:{name:"SHA-384"},name:"RSA-PSS",saltLength:48};case"PS512":return{hash:{name:"SHA-512"},name:"RSA-PSS",saltLength:64};case"RS256":return{hash:{name:"SHA-256"},name:"RSASSA-PKCS1-v1_5"};case"RS384":return{hash:{name:"SHA-384"},name:"RSASSA-PKCS1-v1_5"};case"RS512":return{hash:{name:"SHA-512"},name:"RSASSA-PKCS1-v1_5"};case"ES256":return{hash:{name:"SHA-256"},name:"ECDSA",namedCurve:"P-256"};case"ES384":return{hash:{name:"SHA-384"},name:"ECDSA",namedCurve:"P-384"};case"ES512":return{hash:{name:"SHA-512"},name:"ECDSA",namedCurve:"P-521"};default:throw new s(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}function He(e,t,r){if(D(t))return t;if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw new TypeError(M(t,"CryptoKey"));return K.subtle.importKey("raw",t,{hash:{name:`SHA-${e.substr(-3)}`},name:"HMAC"},!1,[r])}throw new TypeError(M(t,"CryptoKey","Uint8Array"))}const Ke=le.bind(void 0,d,new Map([["b64",!0]]));class De{constructor(e){this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,t){if(!this._protectedHeader&&!this._unprotectedHeader)throw new d("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!w(this._protectedHeader,this._unprotectedHeader))throw new d("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const r={...this._protectedHeader,...this._unprotectedHeader};let n=!0;if(Ke(null==t?void 0:t.crit,this._protectedHeader,r).has("b64")&&(n=this._protectedHeader.b64,"boolean"!=typeof n))throw new d('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:o}=r;if("string"!=typeof o||!o)throw new d('JWS "alg" (Algorithm) Header Parameter missing or invalid');ce(o,e,"sign");let i,s=this._payload;n&&(s=S.encode(T(s))),i=this._protectedHeader?S.encode(T(JSON.stringify(this._protectedHeader))):S.encode("");const a=_(i,S.encode("."),s),c=await(async(e,t,r)=>{const n=await He(e,t,"sign");te(e,n);const o=await K.subtle.sign(Oe(e),n,r);return new Uint8Array(o)})(o,e,a),u={signature:T(c),payload:""};return n&&(u.payload=v.decode(s)),this._unprotectedHeader&&(u.header=this._unprotectedHeader),this._protectedHeader&&(u.protected=v.decode(i)),u}}class Ne{constructor(e){this._flattened=new De(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,t){const r=await this._flattened.sign(e,t);if(void 0===r.payload)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${r.protected}.${r.payload}.${r.signature}`}}const Me=le.bind(void 0,d,new Map([["b64",!0]])),We=pe.bind(void 0,"algorithms");async function je(e,t,r){var n;if(!m(e))throw new d("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new d('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new d("JWS Protected Header incorrect type");if(void 0===e.payload)throw new d("JWS Payload missing");if("string"!=typeof e.signature)throw new d("JWS Signature missing or incorrect type");if(void 0!==e.header&&!m(e.header))throw new d("JWS Unprotected Header incorrect type");let o={};if(e.protected){const t=R(e.protected);try{o=JSON.parse(v.decode(t))}catch(e){throw new d("JWS Protected Header is invalid")}}if(!w(o,e.header))throw new d("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const s={...o,...e.header};let a=!0;if(Me(null==r?void 0:r.crit,o,s).has("b64")&&(a=o.b64,"boolean"!=typeof a))throw new d('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:c}=s;if("string"!=typeof c||!c)throw new d('JWS "alg" (Algorithm) Header Parameter missing or invalid');const u=r&&We(r.algorithms);if(u&&!u.has(c))throw new i('"alg" (Algorithm) Header Parameter not allowed');if(a){if("string"!=typeof e.payload)throw new d("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new d("JWS Payload must be a string or an Uint8Array instance");"function"==typeof t&&(t=await t(o,e)),ce(c,t,"verify");const l=_(S.encode(null!==(n=e.protected)&&void 0!==n?n:""),S.encode("."),"string"==typeof e.payload?S.encode(e.payload):e.payload),p=R(e.signature);if(!await(async(e,t,r,n)=>{const o=await He(e,t,"verify");te(e,o);const i=Oe(e);try{return await K.subtle.verify(i,o,r,n)}catch(e){return!1}})(c,t,p,l))throw new f;let h;h=a?R(e.payload):"string"==typeof e.payload?S.encode(e.payload):e.payload;const y={payload:h};return void 0!==e.protected&&(y.protectedHeader=o),void 0!==e.header&&(y.unprotectedHeader=e.header),y}async function xe(e,t,r){if(e instanceof Uint8Array&&(e=v.decode(e)),"string"!=typeof e)throw new d("Compact JWS must be a string or Uint8Array");const{0:n,1:o,2:i,length:s}=e.split(".");if(3!==s)throw new d("Invalid Compact JWS");const a=await je({payload:o||void 0,protected:n||void 0,signature:i||void 0},t,r);return{payload:a.payload,protectedHeader:a.protectedHeader}}const Fe=new WeakMap;class Je{setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}set _protectedHeader(e){Fe.get(this).protectedHeader=e}get _protectedHeader(){return Fe.get(this).protectedHeader}set _unprotectedHeader(e){Fe.get(this).unprotectedHeader=e}get _unprotectedHeader(){return Fe.get(this).unprotectedHeader}}class Le{constructor(e){this._signatures=[],this._payload=e}addSignature(e,t){const r=new Je;return Fe.set(r,{key:e,options:t}),this._signatures.push(r),r}async sign(){if(!this._signatures.length)throw new d("at least one signature must be added");const e={signatures:[],payload:""};let t=new Set;if(await Promise.all(this._signatures.map((async r=>{const{protectedHeader:n,unprotectedHeader:o,options:i,key:s}=Fe.get(r),a=new De(this._payload);n&&a.setProtectedHeader(n),o&&a.setUnprotectedHeader(o);const{payload:c,...d}=await a.sign(s,i);t.add(c),e.payload=c,e.signatures.push(d)}))),1!==t.size)throw new d("inconsistent use of JWS Unencoded Payload Option (RFC7797)");return e}}async function $e(e,t,r){if(!m(e))throw new d("General JWS must be an object");if(!Array.isArray(e.signatures)||!e.signatures.every(m))throw new d("JWS Signatures missing or incorrect type");for(const n of e.signatures)try{return await je({header:n.header,payload:e.payload,protected:n.protected,signature:n.signature},t,r)}catch(e){}throw new f}var Be=e=>Math.floor(e.getTime()/1e3);const Ve=/^(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)$/i;var Ge=e=>{const t=Ve.exec(e);if(!t)throw new TypeError("Invalid time period format");const r=parseFloat(t[1]);switch(t[2].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":return Math.round(r);case"minute":case"minutes":case"min":case"mins":case"m":return Math.round(60*r);case"hour":case"hours":case"hr":case"hrs":case"h":return Math.round(3600*r);case"day":case"days":case"d":return Math.round(86400*r);case"week":case"weeks":case"w":return Math.round(604800*r);default:return Math.round(31557600*r)}};const qe=e=>e.toLowerCase().replace(/^application\//,"");var ze=(e,t,r={})=>{const{typ:n}=r;if(n&&("string"!=typeof e.typ||qe(e.typ)!==qe(n)))throw new o('unexpected "typ" JWT header value',"typ","check_failed");let i;try{i=JSON.parse(v.decode(t))}catch(e){}if(!m(i))throw new u("JWT Claims Set must be a top-level JSON object");const{issuer:s}=r;if(s&&!(Array.isArray(s)?s:[s]).includes(i.iss))throw new o('unexpected "iss" claim value',"iss","check_failed");const{subject:a}=r;if(a&&i.sub!==a)throw new o('unexpected "sub" claim value',"sub","check_failed");const{audience:c}=r;if(c&&(l="string"==typeof c?[c]:c,!("string"==typeof(d=i.aud)?l.includes(d):Array.isArray(d)&&l.some(Set.prototype.has.bind(new Set(d))))))throw new o('unexpected "aud" claim value',"aud","check_failed");var d,l;let p;switch(typeof r.clockTolerance){case"string":p=Ge(r.clockTolerance);break;case"number":p=r.clockTolerance;break;case"undefined":p=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:h}=r,y=Be(h||new Date);if(void 0!==i.iat||r.maxTokenAge){if("number"!=typeof i.iat)throw new o('"iat" claim must be a number',"iat","invalid");if(void 0===i.exp&&i.iat>y+p)throw new o('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}if(void 0!==i.nbf){if("number"!=typeof i.nbf)throw new o('"nbf" claim must be a number',"nbf","invalid");if(i.nbf>y+p)throw new o('"nbf" claim timestamp check failed',"nbf","check_failed")}if(void 0!==i.exp){if("number"!=typeof i.exp)throw new o('"exp" claim must be a number',"exp","invalid");if(i.exp<=y-p)throw new g('"exp" claim timestamp check failed',"exp","check_failed")}if(r.maxTokenAge){const e=y-i.iat;if(e-p>("number"==typeof r.maxTokenAge?r.maxTokenAge:Ge(r.maxTokenAge)))throw new g('"iat" claim timestamp check failed (too far in the past)',"iat","check_failed");if(e<0-p)throw new o('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}return i};async function Xe(e,t,r){const n=await me(e,t,r),i=ze(n.protectedHeader,n.plaintext,r),{protectedHeader:s}=n;if(void 0!==s.iss&&s.iss!==i.iss)throw new o('replicated "iss" claim header parameter mismatch',"iss","mismatch");if(void 0!==s.sub&&s.sub!==i.sub)throw new o('replicated "sub" claim header parameter mismatch',"sub","mismatch");if(void 0!==s.aud&&JSON.stringify(s.aud)!==JSON.stringify(i.aud))throw new o('replicated "aud" claim header parameter mismatch',"aud","mismatch");return{payload:i,protectedHeader:s}}class Ye{constructor(e){if(!m(e))throw new TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return this._payload="number"==typeof e?{...this._payload,nbf:e}:{...this._payload,nbf:Be(new Date)+Ge(e)},this}setExpirationTime(e){return this._payload="number"==typeof e?{...this._payload,exp:e}:{...this._payload,exp:Be(new Date)+Ge(e)},this}setIssuedAt(e){return this._payload=void 0===e?{...this._payload,iat:Be(new Date)}:{...this._payload,iat:e},this}}class Qe extends Ye{setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setKeyManagementParameters(e){if(this._keyManagementParameters)throw new TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setContentEncryptionKey(e){if(this._cek)throw new TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw new TypeError("setInitializationVector can only be called once");return this._iv=e,this}replicateIssuerAsHeader(){return this._replicateIssuerAsHeader=!0,this}replicateSubjectAsHeader(){return this._replicateSubjectAsHeader=!0,this}replicateAudienceAsHeader(){return this._replicateAudienceAsHeader=!0,this}async encrypt(e,t){const r=new Ae(S.encode(JSON.stringify(this._payload)));return this._replicateIssuerAsHeader&&(this._protectedHeader={...this._protectedHeader,iss:this._payload.iss}),this._replicateSubjectAsHeader&&(this._protectedHeader={...this._protectedHeader,sub:this._payload.sub}),this._replicateAudienceAsHeader&&(this._protectedHeader={...this._protectedHeader,aud:this._payload.aud}),r.setProtectedHeader(this._protectedHeader),this._iv&&r.setInitializationVector(this._iv),this._cek&&r.setContentEncryptionKey(this._cek),this._keyManagementParameters&&r.setKeyManagementParameters(this._keyManagementParameters),r.encrypt(e,t)}}class Ze extends Ye{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,t){var r;const n=new Ne(S.encode(JSON.stringify(this._payload)));if(n.setProtectedHeader(this._protectedHeader),Array.isArray(null===(r=this._protectedHeader)||void 0===r?void 0:r.crit)&&this._protectedHeader.crit.includes("b64")&&!1===this._protectedHeader.b64)throw new u("JWTs MUST NOT use unencoded payload");return n.sign(e,t)}}class et extends Ye{encode(){return`${T(JSON.stringify({alg:"none"}))}.${T(JSON.stringify(this._payload))}.`}static decode(e,t){if("string"!=typeof e)throw new u("Unsecured JWT must be a string");const{0:r,1:n,2:o,length:i}=e.split(".");if(3!==i||""!==o)throw new u("Invalid Unsecured JWT");let s;try{if(s=JSON.parse(v.decode(R(r))),"none"!==s.alg)throw new Error}catch(e){throw new u("Invalid Unsecured JWT")}return{payload:ze(s,R(n),t),header:s}}}async function tt(e,t,r){var n;const o=await xe(e,t,r);if((null===(n=o.protectedHeader.crit)||void 0===n?void 0:n.includes("b64"))&&!1===o.protectedHeader.b64)throw new u("JWTs MUST NOT use unencoded payload");return{payload:ze(o.protectedHeader,o.payload,r),protectedHeader:o.protectedHeader}}const rt=T,nt=R;function ot(e){let t;if("string"==typeof e){const r=e.split(".");3!==r.length&&5!==r.length||([t]=r)}else if("object"==typeof e&&e){if(!("protected"in e))throw new TypeError("Token does not contain a Protected Header");t=e.protected}try{if("string"!=typeof t||!t)throw new Error;const e=JSON.parse(v.decode(nt(t)));if(!m(e))throw new Error;return e}catch(e){throw new TypeError("Invalid Token or Protected Header formatting")}}function it(e){var t;const r=null!==(t=null==e?void 0:e.modulusLength)&&void 0!==t?t:2048;if("number"!=typeof r||r<2048)throw new s("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return r}async function st(e,t){return async function(e,t){var r,n;let o,i;switch(e){case"PS256":case"PS384":case"PS512":o={name:"RSA-PSS",hash:{name:`SHA-${e.substr(-3)}`},publicExponent:new Uint8Array([1,0,1]),modulusLength:it(t)},i=["sign","verify"];break;case"RS256":case"RS384":case"RS512":o={name:"RSASSA-PKCS1-v1_5",hash:{name:`SHA-${e.substr(-3)}`},publicExponent:new Uint8Array([1,0,1]),modulusLength:it(t)},i=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":o={name:"RSA-OAEP",hash:{name:`SHA-${parseInt(e.substr(-3),10)||1}`},publicExponent:new Uint8Array([1,0,1]),modulusLength:it(t)},i=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":o={name:"ECDSA",namedCurve:"P-256"},i=["sign","verify"];break;case"ES384":o={name:"ECDSA",namedCurve:"P-384"},i=["sign","verify"];break;case"ES512":o={name:"ECDSA",namedCurve:"P-521"},i=["sign","verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":o={name:"ECDH",namedCurve:null!==(r=null==t?void 0:t.crv)&&void 0!==r?r:"P-256"},i=["deriveKey","deriveBits"];break;default:throw new s('unsupported or invalid JWK "alg" (Algorithm) Parameter value')}return K.subtle.generateKey(o,null!==(n=null==t?void 0:t.extractable)&&void 0!==n&&n,i)}(e,t)}async function at(e,t){return async function(e,t){var r;let n,o,i;switch(e){case"HS256":case"HS384":case"HS512":n=parseInt(e.substr(-3),10),o={name:"HMAC",hash:{name:`SHA-${n}`},length:n},i=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return n=parseInt(e.substr(-3),10),z(new Uint8Array(n>>3));case"A128KW":case"A192KW":case"A256KW":n=parseInt(e.substring(1,4),10),o={name:"AES-KW",length:n},i=["wrapKey","unwrapKey"];break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":case"A128GCM":case"A192GCM":case"A256GCM":n=parseInt(e.substring(1,4),10),o={name:"AES-GCM",length:n},i=["encrypt","decrypt"];break;default:throw new s('unsupported or invalid JWK "alg" (Algorithm) Parameter value')}return K.subtle.generateKey(o,null!==(r=null==t?void 0:t.extractable)&&void 0!==r&&r,i)}(e,t)}const ct=z},92981:(e,t,r)=>{"use strict";r.r(t),r.d(t,{CordovaIFrameNavigator:()=>n.CordovaIFrameNavigator,CordovaPopupNavigator:()=>n.CordovaPopupNavigator,InMemoryWebStorage:()=>n.InMemoryWebStorage,Log:()=>n.Log,OidcClient:()=>n.OidcClient,SessionMonitor:()=>n.SessionMonitor,User:()=>n.User,UserManager:()=>n.UserManager,Version:()=>n.Version,WebStorageStateStore:()=>n.WebStorageStateStore,clearOidcPersistentStorage:()=>h,getBearerToken:()=>d,getDpopToken:()=>u,refresh:()=>l,registerClient:()=>s,removeOidcQueryParam:()=>p});var n=r(64671),o=r(80835),i=r(24520);async function s(e,t){var r;if(!t.registrationEndpoint)throw new Error("Dynamic Registration could not be completed because the issuer has no registration endpoint.");if(!Array.isArray(t.idTokenSigningAlgValuesSupported))throw new Error("The OIDC issuer discovery profile is missing the 'id_token_signing_alg_values_supported' value, which is mandatory.");const n=(0,o.determineSigningAlg)(t.idTokenSigningAlgValuesSupported,o.PREFERRED_SIGNING_ALG),i={client_name:e.clientName,application_type:"web",redirect_uris:[null===(r=e.redirectUrl)||void 0===r?void 0:r.toString()],subject_type:"public",token_endpoint_auth_method:"client_secret_basic",id_token_signed_response_alg:n,grant_types:["authorization_code","refresh_token"]},s={"Content-Type":"application/json"};e.registrationAccessToken&&(s.Authorization=`Bearer ${e.registrationAccessToken}`);const a=await fetch(t.registrationEndpoint.toString(),{method:"POST",headers:s,body:JSON.stringify(i)});if(a.ok){const t=await a.json();return function(e,t){if(void 0===e.client_id)throw new Error(`Dynamic client registration failed: no client_id has been found on ${JSON.stringify(e)}`);if(t.redirectUrl&&(void 0===e.redirect_uris||e.redirect_uris[0]!==t.redirectUrl.toString()))throw new Error(`Dynamic client registration failed: the returned redirect URIs ${JSON.stringify(e.redirect_uris)} don't match the provided ${JSON.stringify([t.redirectUrl.toString()])}`)}(t,e),{clientId:t.client_id,clientSecret:t.client_secret,idTokenSignedResponseAlg:t.id_token_signed_response_alg,clientType:"dynamic"}}throw 400===a.status&&function(e,t){var r,n,o,i;if("invalid_redirect_uri"===e.error)throw new Error(`Dynamic client registration failed: the provided redirect uri [${null===(r=t.redirectUrl)||void 0===r?void 0:r.toString()}] is invalid - ${null!==(n=e.error_description)&&void 0!==n?n:""}`);if("invalid_client_metadata"===e.error)throw new Error(`Dynamic client registration failed: the provided client metadata ${JSON.stringify(t)} is invalid - ${null!==(o=e.error_description)&&void 0!==o?o:""}`);throw new Error(`Dynamic client registration failed: ${e.error} - ${null!==(i=e.error_description)&&void 0!==i?i:""}`)}(await a.json(),e),new Error(`Dynamic client registration failed: the server returned ${a.status} ${a.statusText} - ${await a.text()}`)}function a(e){return void 0!==e.error_description&&"string"==typeof e.error_description}function c(e,t){if(void 0!==(r=e).error&&"string"==typeof r.error)throw new o.OidcProviderError(`Token endpoint returned error [${e.error}]${a(e)?`: ${e.error_description}`:""}${function(e){return void 0!==e.error_uri&&"string"==typeof e.error_uri}(e)?` (see ${e.error_uri})`:""}`,e.error,a(e)?e.error_description:void 0);var r;if(!function(e){return void 0!==e.access_token&&"string"==typeof e.access_token}(e))throw new o.InvalidResponseError(["access_token"]);if(!function(e){return void 0!==e.id_token&&"string"==typeof e.id_token}(e))throw new o.InvalidResponseError(["id_token"]);if(!function(e){return void 0!==e.token_type&&"string"==typeof e.token_type}(e))throw new o.InvalidResponseError(["token_type"]);if(!function(e){return void 0===e.expires_in||"number"==typeof e.expires_in}(e))throw new o.InvalidResponseError(["expires_in"]);if(!t&&"bearer"!==e.token_type.toLowerCase())throw new Error(`Invalid token endpoint response: requested a [Bearer] token, but got a 'token_type' value of [${e.token_type}].`);return e}async function d(e){let t;try{const r=new n.OidcClient({response_mode:"query",loadUserInfo:!1});if(t=await r.processSigninResponse(e),void 0===r.settings.metadata)throw new Error("Cannot retrieve issuer metadata from client information in storage.");if(void 0===r.settings.metadata.jwks_uri)throw new Error("Missing some issuer metadata from client information in storage: 'jwks_uri' is undefined");if(void 0===r.settings.metadata.issuer)throw new Error("Missing some issuer metadata from client information in storage: 'issuer' is undefined");if(void 0===r.settings.client_id)throw new Error("Missing some client information in storage: 'client_id' is undefined");const i=await(0,o.getWebidFromTokenPayload)(t.id_token,r.settings.metadata.jwks_uri,r.settings.metadata.issuer,r.settings.client_id);return{accessToken:t.access_token,idToken:t.id_token,webId:i,refreshToken:t.refresh_token}}catch(t){throw new Error(`Problem handling Auth Code Grant (Flow) redirect - URL [${e}]: ${t}`)}}async function u(e,t,r){return async function(e,t,r,n){!function(e,t){if(t.grantType&&(!e.grantTypesSupported||!e.grantTypesSupported.includes(t.grantType)))throw new Error(`The issuer [${e.issuer}] does not support the [${t.grantType}] grant`);if(!e.tokenEndpoint)throw new Error(`This issuer [${e.issuer}] does not have a token endpoint`)}(e,r);const s={"content-type":"application/x-www-form-urlencoded"};let a;n&&(a=await(0,o.generateDpopKeyPair)(),s.DPoP=await(0,o.createDpopHeader)(e.tokenEndpoint,"POST",a)),t.clientSecret&&(s.Authorization=`Basic ${btoa(`${t.clientId}:${t.clientSecret}`)}`);const d={method:"POST",headers:s,body:(0,i.Z)({grant_type:r.grantType,redirect_uri:r.redirectUrl,code:r.code,code_verifier:r.codeVerifier,client_id:t.clientId})},u=await await fetch(e.tokenEndpoint,d),l=c(await u.json(),n),p=await(0,o.getWebidFromTokenPayload)(l.id_token,e.jwksUri,e.issuer,t.clientId);return{accessToken:l.access_token,idToken:l.id_token,refreshToken:(h=l,void 0!==h.refresh_token&&"string"==typeof h.refresh_token?l.refresh_token:void 0),webId:p,dpopKey:a,expiresIn:l.expires_in};var h}(e,t,r,!0)}async function l(e,t,r,n){const s={grant_type:"refresh_token",refresh_token:e,scope:"openid offline_access"};let a={};void 0!==n&&(a={DPoP:await(0,o.createDpopHeader)(t.tokenEndpoint,"POST",n)});let d={};void 0!==r.clientSecret&&(d={Authorization:`Basic ${btoa(`${r.clientId}:${r.clientSecret}`)}`});const u=await fetch(t.tokenEndpoint,{method:"POST",body:(0,i.Z)(s),headers:{...a,...d,"Content-Type":"application/x-www-form-urlencoded"}});let l;try{l=await u.json()}catch(e){throw new Error(`The token endpoint of issuer ${t.issuer} returned a malformed response.`)}const p=c(l,void 0!==n),h=await(0,o.getWebidFromTokenPayload)(p.id_token,t.jwksUri,t.issuer,r.clientId);return{accessToken:p.access_token,idToken:p.id_token,refreshToken:"string"==typeof p.refresh_token?p.refresh_token:void 0,webId:h,dpopKey:n,expiresIn:p.expires_in}}function p(e){const t=new URL(e);return t.searchParams.delete("code"),t.searchParams.delete("state"),t.hash="",t.toString()}async function h(){const e=new n.OidcClient({response_mode:"query"});await e.clearStaleState(new n.WebStorageStateStore({}));const t=window.localStorage,r=[];for(let e=0;e<=t.length;e+=1){const n=t.key(e);n&&(n.match(/^oidc\..+$/)||n.match(/^solidClientAuthenticationUser:.+$/))&&r.push(n)}r.forEach((e=>t.removeItem(e)))}},70143:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(80835),o=r(92981),i=r(60991),s=r(33783),a=(e,t)=>window.fetch(e,t);t.default=class{constructor(e,t,r,c,d){this.loginHandler=e,this.redirectHandler=t,this.logoutHandler=r,this.sessionInfoManager=c,this.issuerConfigFetcher=d,this.login=async(e,t)=>{var r,n;await this.sessionInfoManager.clear(e.sessionId);const i=o.removeOidcQueryParam(null!==(r=e.redirectUrl)&&void 0!==r?r:window.location.href);await this.loginHandler.handle({...e,redirectUrl:i,clientName:null!==(n=e.clientName)&&void 0!==n?n:e.clientId,eventEmitter:t})},this.fetch=a,this.logout=async e=>{await this.logoutHandler.handle(e),this.fetch=a},this.getSessionInfo=async e=>this.sessionInfoManager.get(e),this.getAllSessionInfo=async()=>this.sessionInfoManager.getAll(),this.validateCurrentSession=async()=>{const e=window.localStorage.getItem(s.KEY_CURRENT_SESSION);if(null===e)return null;const t=await this.sessionInfoManager.get(e);if(void 0===t||void 0===t.idToken||void 0===t.clientAppId||void 0===t.issuer)return null;const r=await this.issuerConfigFetcher.fetchConfig(t.issuer);try{const e=await n.fetchJwks(r.jwksUri,r.issuer);return await i.jwtVerify(t.idToken,await i.parseJwk(e),{audience:t.clientAppId,issuer:r.issuer}),t}catch(e){}return null},this.handleIncomingRedirect=async(e,t)=>{const r=await this.redirectHandler.handle(e,t);this.fetch=r.fetch.bind(window);const n=new URL(e);return n.searchParams.delete("state"),n.searchParams.delete("code"),n.searchParams.delete("id_token"),n.searchParams.delete("access_token"),n.searchParams.delete("error"),n.searchParams.delete("error_description"),window.history.replaceState(null,"",n.toString()),{isLoggedIn:r.isLoggedIn,webId:r.webId,sessionId:r.sessionId,expirationDate:r.expirationDate}}}}},83598:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Session=t.silentlyAuthenticate=void 0;const n=r(86874),o=r(80835),i=r(93132),s=r(93537),a=r(33783),c=r(2464);async function d(e,t,r={inIframe:!1},n){var o;const i=await t.validateCurrentSession();return null!==i&&(window.localStorage.setItem(a.KEY_CURRENT_URL,window.location.href),await t.login({sessionId:e,prompt:"none",oidcIssuer:i.issuer,redirectUrl:i.redirectUrl,clientId:i.clientAppId,clientSecret:i.clientAppSecret,tokenType:null!==(o=i.tokenType)&&void 0!==o?o:"DPoP",inIframe:r.inIframe},n),!0)}function u(e){return!!(null==e?void 0:e.isLoggedIn)}t.silentlyAuthenticate=d;class l extends n.EventEmitter{constructor(e={},t){super(),this.tokenRequestInProgress=!1,this.tmpFetchWithCookies=!1,this.login=async e=>{var t;return await this.clientAuthentication.login({sessionId:this.info.sessionId,...e,tokenType:null!==(t=e.tokenType)&&void 0!==t?t:"DPoP"},this),new Promise((()=>{}))},this.fetch=async(e,t)=>this.clientAuthentication.fetch(e,{...t,credentials:this.tmpFetchWithCookies?"include":null==t?void 0:t.credentials}),this.logout=async()=>{await this.clientAuthentication.logout(this.info.sessionId),this.info.isLoggedIn=!1,this.tmpFetchWithCookies=!1,this.emit("logout")},this.handleIncomingRedirect=async(e={})=>{var t;if(this.info.isLoggedIn)return this.info;if(this.tokenRequestInProgress)return;const r="string"==typeof e?{url:e}:e,n=null!==(t=r.url)&&void 0!==t?t:window.location.href;if(null!==window.frameElement)return void c.postRedirectUrlToParent(n);!0!==r.useEssSession||!0===r.restorePreviousSession?window.localStorage.setItem("tmp-resource-server-session-enabled","false"):window.localStorage.setItem("tmp-resource-server-session-enabled","true");const o=window.localStorage.getItem("tmp-resource-server-session-info");if("string"==typeof o&&!0!==r.restorePreviousSession&&!0===r.useEssSession){const e=JSON.parse(o);if(function(e){var t;const r=Object.keys(null!==(t=e.sessions)&&void 0!==t?t:{});return"string"==typeof e.webId&&r.length>0&&"number"==typeof e.sessions[r[0]].expiration}(e)){const t=Object.keys(e.sessions),r=new URL(e.webId).hostname,n=t.find((e=>new URL(e).hostname===r)),o=null!=n?n:t[0];if(e.sessions[o].expiration-Date.now()>3e5)return this.info.isLoggedIn=!0,this.info.webId=e.webId,this.tmpFetchWithCookies=!0,this.info}}this.tokenRequestInProgress=!0;const i=await this.clientAuthentication.handleIncomingRedirect(n,this);if(u(i)){this.setSessionInfo(i);const e=window.localStorage.getItem(a.KEY_CURRENT_URL);null===e?this.emit("login"):(window.localStorage.removeItem(a.KEY_CURRENT_URL),this.emit("sessionRestore",e))}else if(!0===r.restorePreviousSession){const e=window.localStorage.getItem(a.KEY_CURRENT_SESSION);if(null!==e&&await d(e,this.clientAuthentication,void 0,this))return new Promise((()=>{}))}return this.tokenRequestInProgress=!1,i},e.clientAuthentication?this.clientAuthentication=e.clientAuthentication:e.secureStorage&&e.insecureStorage?this.clientAuthentication=s.getClientAuthenticationWithDependencies({secureStorage:e.secureStorage,insecureStorage:e.insecureStorage}):this.clientAuthentication=s.getClientAuthenticationWithDependencies({}),e.sessionInfo?this.info={sessionId:e.sessionInfo.sessionId,isLoggedIn:!1,webId:e.sessionInfo.webId}:this.info={sessionId:null!=t?t:i.v4(),isLoggedIn:!1},c.setupIframeListener((async e=>{const t=await this.clientAuthentication.handleIncomingRedirect(e,this);u(t)&&this.setSessionInfo(t)})),this.on("tokenRenewal",(()=>d(this.info.sessionId,this.clientAuthentication,{inIframe:!0},this)))}onLogin(e){this.on("login",e)}onLogout(e){this.on("logout",e)}onError(e){this.on(o.EVENTS.ERROR,e)}onSessionRestore(e){this.on("sessionRestore",e)}onSessionExpiration(e){this.on(o.EVENTS.SESSION_EXPIRED,e)}setSessionInfo(e){this.info.isLoggedIn=e.isLoggedIn,this.info.webId=e.webId,this.info.sessionId=e.sessionId,this.info.expirationDate=e.expirationDate,this.on(o.EVENTS.SESSION_EXTENDED,(e=>{this.info.expirationDate=Date.now()+1e3*e}))}}t.Session=l},33783:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KEY_CURRENT_URL=t.KEY_CURRENT_SESSION=void 0;const n=r(80835);t.KEY_CURRENT_SESSION=`${n.SOLID_CLIENT_AUTHN_KEY_PREFIX}currentSession`,t.KEY_CURRENT_URL=`${n.SOLID_CLIENT_AUTHN_KEY_PREFIX}currentUrl`},37814:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.onSessionRestore=t.onLogout=t.onLogin=t.handleIncomingRedirect=t.logout=t.login=t.fetch=t.getDefaultSession=void 0;const n=r(83598);let o;function i(){return void 0===o&&(o=new n.Session),o}t.getDefaultSession=i,t.fetch=(...e)=>i().fetch(...e),t.login=(...e)=>i().login(...e),t.logout=(...e)=>i().logout(...e),t.handleIncomingRedirect=(...e)=>i().handleIncomingRedirect(...e),t.onLogin=(...e)=>i().onLogin(...e),t.onLogout=(...e)=>i().onLogout(...e),t.onSessionRestore=(...e)=>i().onSessionRestore(...e)},93537:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getClientAuthenticationWithDependencies=void 0;const o=r(80835),i=n(r(20437)),s=n(r(70143)),a=n(r(62018)),c=n(r(21590)),d=n(r(94377)),u=r(35220),l=n(r(72186)),p=r(63624),h=r(4520),y=n(r(55912)),f=n(r(55394)),g=n(r(62536)),w=n(r(27826)),m=r(61446),S=n(r(13144));t.getClientAuthenticationWithDependencies=function(e){const t=new o.InMemoryStorage,r=e.secureStorage||t,n=e.insecureStorage||new f.default,v=new i.default(r,n),E=new d.default(v),_=new w.default(v),b=new p.SessionInfoManager(v),A=new S.default(v,E,_),I=new a.default(v,new c.default(v,new g.default),E,_),P=new y.default([new m.ErrorOidcHandler,new h.AuthCodeRedirectHandler(v,b,E,_,A),new u.FallbackRedirectHandler]);return new s.default(I,P,new l.default(b),b,E)}},2464:(e,t)=>{"use strict";let r;function n(){return void 0===r&&(r=window.document.createElement("iframe"),r.setAttribute("hidden","true"),r.setAttribute("sandbox","allow-scripts allow-same-origin")),r}Object.defineProperty(t,"__esModule",{value:!0}),t.postRedirectUrlToParent=t.setupIframeListener=t.redirectInIframe=void 0,t.redirectInIframe=function(e){const t=n();window.document.body.appendChild(t),t.src=e},t.setupIframeListener=function(e){"undefined"!=typeof window&&window.addEventListener("message",(async t=>{const r=n();t.origin===window.location.origin&&t.source===r.contentWindow&&"string"==typeof t.data.redirectUrl&&await e(t.data.redirectUrl),window.document.body.contains(r)&&window.document.body.removeChild(r)}))},t.postRedirectUrlToParent=function(e){window.top.postMessage({redirectUrl:e},window.location.origin)}},94305:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.InMemoryStorage=t.ConfigurationError=t.NotImplementedError=t.getClientAuthenticationWithDependencies=t.Session=void 0;var i=r(83598);Object.defineProperty(t,"Session",{enumerable:!0,get:function(){return i.Session}});var s=r(93537);Object.defineProperty(t,"getClientAuthenticationWithDependencies",{enumerable:!0,get:function(){return s.getClientAuthenticationWithDependencies}}),o(r(37814),t);var a=r(80835);Object.defineProperty(t,"NotImplementedError",{enumerable:!0,get:function(){return a.NotImplementedError}}),Object.defineProperty(t,"ConfigurationError",{enumerable:!0,get:function(){return a.ConfigurationError}}),Object.defineProperty(t,"InMemoryStorage",{enumerable:!0,get:function(){return a.InMemoryStorage}})},27826:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(92981);t.default=class{constructor(e){this.storageUtility=e}async getClient(e,t){var r;const[o,i]=await Promise.all([this.storageUtility.getForUser(e.sessionId,"clientId",{secure:!1}),this.storageUtility.getForUser(e.sessionId,"clientSecret",{secure:!1})]);if(o)return{clientId:o,clientSecret:i,clientType:"dynamic"};const s={...e};s.registrationAccessToken=null!==(r=s.registrationAccessToken)&&void 0!==r?r:await this.storageUtility.getForUser(e.sessionId,"registrationAccessToken");try{const e=await n.registerClient(s,t),r={clientId:e.clientId};return e.clientSecret&&(r.clientSecret=e.clientSecret),e.idTokenSignedResponseAlg&&(r.idTokenSignedResponseAlg=e.idTokenSignedResponseAlg),await this.storageUtility.setForUser(s.sessionId,r,{secure:!1}),e}catch(e){throw new Error(`Client registration failed: [${e.toString()}]`)}}}},94377:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WELL_KNOWN_OPENID_CONFIG=void 0;const n=r(80835),o=r(37226);t.WELL_KNOWN_OPENID_CONFIG=".well-known/openid-configuration";const i={issuer:{toKey:"issuer",convertToUrl:!0},authorization_endpoint:{toKey:"authorizationEndpoint",convertToUrl:!0},token_endpoint:{toKey:"tokenEndpoint",convertToUrl:!0},userinfo_endpoint:{toKey:"userinfoEndpoint",convertToUrl:!0},jwks_uri:{toKey:"jwksUri",convertToUrl:!0},registration_endpoint:{toKey:"registrationEndpoint",convertToUrl:!0},scopes_supported:{toKey:"scopesSupported"},response_types_supported:{toKey:"responseTypesSupported"},response_modes_supported:{toKey:"responseModesSupported"},grant_types_supported:{toKey:"grantTypesSupported"},acr_values_supported:{toKey:"acrValuesSupported"},subject_types_supported:{toKey:"subjectTypesSupported"},id_token_signing_alg_values_supported:{toKey:"idTokenSigningAlgValuesSupported"},id_token_encryption_alg_values_supported:{toKey:"idTokenEncryptionAlgValuesSupported"},id_token_encryption_enc_values_supported:{toKey:"idTokenEncryptionEncValuesSupported"},userinfo_signing_alg_values_supported:{toKey:"userinfoSigningAlgValuesSupported"},userinfo_encryption_alg_values_supported:{toKey:"userinfoEncryptionAlgValuesSupported"},userinfo_encryption_enc_values_supported:{toKey:"userinfoEncryptionEncValuesSupported"},request_object_signing_alg_values_supported:{toKey:"requestObjectSigningAlgValuesSupported"},request_object_encryption_alg_values_supported:{toKey:"requestObjectEncryptionAlgValuesSupported"},request_object_encryption_enc_values_supported:{toKey:"requestObjectEncryptionEncValuesSupported"},token_endpoint_auth_methods_supported:{toKey:"tokenEndpointAuthMethodsSupported"},token_endpoint_auth_signing_alg_values_supported:{toKey:"tokenEndpointAuthSigningAlgValuesSupported"},display_values_supported:{toKey:"displayValuesSupported"},claim_types_supported:{toKey:"claimTypesSupported"},claims_supported:{toKey:"claimsSupported"},service_documentation:{toKey:"serviceDocumentation"},claims_locales_supported:{toKey:"claimsLocalesSupported"},ui_locales_supported:{toKey:"uiLocalesSupported"},claims_parameter_supported:{toKey:"claimsParameterSupported"},request_parameter_supported:{toKey:"requestParameterSupported"},request_uri_parameter_supported:{toKey:"requestUriParameterSupported"},require_request_uri_registration:{toKey:"requireRequestUriRegistration"},op_policy_uri:{toKey:"opPolicyUri",convertToUrl:!0},op_tos_uri:{toKey:"opTosUri",convertToUrl:!0},solid_oidc_supported:{toKey:"solidOidcSupported"}};class s{constructor(e){this.storageUtility=e}static getLocalStorageKey(e){return`issuerConfig:${e}`}async fetchConfig(e){let r;const a=o.appendToUrlPathname(e,t.WELL_KNOWN_OPENID_CONFIG),c=await window.fetch(a);try{r=function(e){const t={};return Object.keys(e).forEach((r=>{i[r]&&(t[i[r].toKey]=e[r])})),t}(await c.json())}catch(t){throw new n.ConfigurationError(`[${e.toString()}] has an invalid configuration: ${t.message}`)}return await this.storageUtility.set(s.getLocalStorageKey(e),JSON.stringify(r)),r}}t.default=s},62018:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(80835);function o(e){return"string"==typeof e.oidcIssuer}function i(e){return"string"==typeof e.redirectUrl}t.default=class{constructor(e,t,r,n){this.storageUtility=e,this.oidcHandler=t,this.issuerConfigFetcher=r,this.clientRegistrar=n}async canHandle(e){return o(e)&&i(e)}async handle(e){if(!o(e))throw new n.ConfigurationError(`OidcLoginHandler requires an OIDC issuer: missing property 'oidcIssuer' in ${JSON.stringify(e)}`);if(!i(e))throw new n.ConfigurationError(`OidcLoginHandler requires a redirect URL: missing property 'redirectUrl' in ${JSON.stringify(e)}`);const t=await this.issuerConfigFetcher.fetchConfig(e.oidcIssuer),r=await n.handleRegistration(e,t,this.storageUtility,this.clientRegistrar),s={issuer:t.issuer,dpop:"dpop"===e.tokenType.toLowerCase(),...e,issuerConfiguration:t,client:r};return this.oidcHandler.handle(s)}}},62536:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(2464);t.default=class{redirect(e,t){t&&t.handleRedirect?t.handleRedirect(e):t&&t.redirectByReplacingState?window.history.replaceState({},"",e):(null==t?void 0:t.redirectInIframe)?n.redirectInIframe(e):window.location.href=e}}},21590:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(92981);t.default=class{constructor(e,t){this.storageUtility=e,this.redirector=t}async canHandle(e){return!!(e.issuerConfiguration.grantTypesSupported&&e.issuerConfiguration.grantTypesSupported.indexOf("authorization_code")>-1)}async handle(e){var t;const r={authority:e.issuer.toString(),client_id:e.client.clientId,client_secret:e.client.clientSecret,redirect_uri:e.redirectUrl.toString(),post_logout_redirect_uri:e.redirectUrl.toString(),response_type:"code",scope:"openid offline_access",filterProtocolClaims:!0,loadUserInfo:!1,code_verifier:!0,prompt:null!==(t=e.prompt)&&void 0!==t?t:"consent"},o=new n.OidcClient(r),{redirector:i}=this,s=this.storageUtility;try{const t=await o.createSigninRequest();await Promise.all([s.setForUser(t.state._id,{sessionId:e.sessionId}),s.setForUser(e.sessionId,{codeVerifier:t.state._code_verifier,issuer:e.issuer.toString(),redirectUrl:e.redirectUrl,dpop:e.dpop?"true":"false"})]),i.redirect(t.url.toString(),{handleRedirect:e.handleRedirect,redirectInIframe:e.inIframe})}catch(e){console.error(e)}}}},55912:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(80835);class o extends n.AggregateHandler{constructor(e){super(e)}}t.default=o},4520:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AuthCodeRedirectHandler=t.DEFAULT_LIFESPAN=void 0;const n=r(80835),o=r(92981),i=r(33783);t.DEFAULT_LIFESPAN=18e5,t.AuthCodeRedirectHandler=class{constructor(e,t,r,n,o){this.storageUtility=e,this.sessionInfoManager=t,this.issuerConfigFetcher=r,this.clientRegistrar=n,this.tokerRefresher=o}async canHandle(e){try{const t=new URL(e);return null!==t.searchParams.get("code")&&null!==t.searchParams.get("state")}catch(t){throw new Error(`[${e}] is not a valid URL, and cannot be used as a redirect URL: ${t.toString()}`)}}async handle(e,r){if(!await this.canHandle(e))throw new Error(`AuthCodeRedirectHandler cannot handle [${e}]: it is missing one of [code, state].`);const s=new URL(e),a=s.searchParams.get("state"),c=await this.storageUtility.getForUser(a,"sessionId",{errorIfNull:!0}),d="true"===await this.storageUtility.getForUser(c,"dpop"),u=await this.storageUtility.getForUser(c,"issuer",{errorIfNull:!0});window.localStorage.setItem(i.KEY_CURRENT_SESSION,c);const l=await this.issuerConfigFetcher.fetchConfig(u),p=await this.clientRegistrar.getClient({sessionId:c},l);let h;const y=Date.now();if(d){const e=await this.storageUtility.getForUser(c,"codeVerifier",{errorIfNull:!0}),t=await this.storageUtility.getForUser(c,"redirectUrl",{errorIfNull:!0});h=await o.getDpopToken(l,p,{grantType:"authorization_code",code:s.searchParams.get("code"),codeVerifier:e,redirectUrl:t})}else h=await o.getBearerToken(s.toString());let f;void 0!==h.refreshToken&&(f={sessionId:c,refreshToken:h.refreshToken,tokenRefresher:this.tokerRefresher});const g=await n.buildAuthenticatedFetch(fetch,h.accessToken,{dpopKey:h.dpopKey,refreshOptions:f,eventEmitter:r,expiresIn:h.expiresIn});await this.storageUtility.setForUser(c,{refreshToken:"<Refresh token that *is* coming back in the redirect URL is not yet being parsed and provided by oidc-client-js in it's response object>",webId:h.webId,isLoggedIn:"true"},{secure:!0}),s.searchParams.delete("code"),await this.storageUtility.setForUser(c,{redirectUrl:s.toString(),idToken:h.idToken},{secure:!1}),"false"===window.localStorage.getItem("tmp-resource-server-session-enabled")||await async function(e,r,n){const o=new URL(e).origin;await r(e);try{if(200===(await r(`${o}/session`)).status)return void await n.storeResourceServerSessionInfo(e,o,Date.now()+t.DEFAULT_LIFESPAN);await n.clearResourceServerSessionInfo(o)}catch(e){await n.clearResourceServerSessionInfo(o)}}(h.webId,g,this.storageUtility);const w=await this.sessionInfoManager.get(c);if(!w)throw new Error(`Could not retrieve session: [${c}].`);return Object.assign(w,{fetch:g,expirationDate:"number"==typeof h.expiresIn?y+1e3*h.expiresIn:null})}}},61446:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorOidcHandler=void 0;const n=r(80835),o=r(63624);t.ErrorOidcHandler=class{async canHandle(e){try{return new URL(e).searchParams.has("error")}catch(t){throw new Error(`[${e}] is not a valid URL, and cannot be used as a redirect URL: ${t.toString()}`)}}async handle(e,t){if(void 0!==t){const r=new URL(e),o=r.searchParams.get("error"),i=r.searchParams.get("error_description");t.emit(n.EVENTS.ERROR,o,i)}return o.getUnauthenticatedSession()}}},35220:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FallbackRedirectHandler=void 0;const n=r(63624);t.FallbackRedirectHandler=class{async canHandle(e){try{return new URL(e),!0}catch(t){throw new Error(`[${e}] is not a valid URL, and cannot be used as a redirect URL: ${t.toString()}`)}}async handle(e){return n.getUnauthenticatedSession()}}},13144:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(80835),o=r(92981);t.default=class{constructor(e,t,r){this.storageUtility=e,this.issuerConfigFetcher=t,this.clientRegistrar=r}async refresh(e,t,r,i){const s=await n.loadOidcContextFromStorage(e,this.storageUtility,this.issuerConfigFetcher),a=await this.clientRegistrar.getClient({sessionId:e},s.issuerConfig);if(void 0===t)throw new Error(`Session [${e}] has no refresh token to allow it to refresh its access token.`);if(s.dpop&&void 0===r)throw new Error(`For session [${e}], the key bound to the DPoP access token must be provided to refresh said access token.`);const c=await o.refresh(t,s.issuerConfig,a,r);return void 0!==c.refreshToken&&(null==i||i.emit(n.EVENTS.NEW_REFRESH_TOKEN,c.refreshToken),await this.storageUtility.setForUser(e,{refreshToken:c.refreshToken})),c}}},72186:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.sessionInfoManager=e}async canHandle(){return!0}async handle(e){await this.sessionInfoManager.clear(e)}}},63624:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SessionInfoManager=t.clear=t.getUnauthenticatedSession=void 0;const n=r(80835),o=r(93132),i=r(92981);async function s(e,t){const r=await t.get("tmp-resource-server-session-info"),n=JSON.parse(null!=r?r:"{}"),{webId:o}=n;if(void 0!==o){const e=new URL(o).origin;await t.clearResourceServerSessionInfo(e)}await Promise.all([t.deleteAllUserData(e,{secure:!1}),t.deleteAllUserData(e,{secure:!0}),t.delete("clientKey",{secure:!1})]),await i.clearOidcPersistentStorage()}t.getUnauthenticatedSession=function(){return{isLoggedIn:!1,sessionId:o.v4(),fetch}},t.clear=s,t.SessionInfoManager=class{constructor(e){this.storageUtility=e}update(e,t){throw new Error("Not Implemented")}async get(e){var t;const r=await this.storageUtility.getForUser(e,"isLoggedIn",{secure:!0}),o=await this.storageUtility.getForUser(e,"webId",{secure:!0}),i=await this.storageUtility.getForUser(e,"clientId",{secure:!1}),s=await this.storageUtility.getForUser(e,"clientSecret",{secure:!1}),a=await this.storageUtility.getForUser(e,"idToken",{secure:!1}),c=await this.storageUtility.getForUser(e,"redirectUrl",{secure:!1}),d=await this.storageUtility.getForUser(e,"refreshToken",{secure:!0}),u=await this.storageUtility.getForUser(e,"issuer",{secure:!1}),l=null!==(t=await this.storageUtility.getForUser(e,"tokenType",{secure:!1}))&&void 0!==t?t:"DPoP";if(!n.isSupportedTokenType(l))throw new Error(`Tokens of type [${l}] are not supported.`);if(void 0!==i||void 0!==a||void 0!==r||void 0!==o||void 0!==d)return{sessionId:e,webId:o,isLoggedIn:"true"===r,redirectUrl:c,idToken:a,refreshToken:d,issuer:u,clientAppId:i,clientAppSecret:s,tokenType:l}}async getAll(){throw new Error("Not implemented")}async clear(e){return s(e,this.storageUtility)}async register(e){throw new Error("Not implemented")}async getRegisteredSessionIdAll(){throw new Error("Not implemented")}async clearAll(){throw new Error("Not implemented")}}},55394:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{get storage(){return window.localStorage}async get(e){return this.storage.getItem(e)||void 0}async set(e,t){this.storage.setItem(e,t)}async delete(e){this.storage.removeItem(e)}}},20437:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(80835);class o extends n.StorageUtility{constructor(e,t){super(e,t)}}t.default=o},37226:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.appendToUrlPathname=void 0,t.appendToUrlPathname=function(e,t){const r=new URL(e),n=r.pathname;return r.pathname=`${n}${n.endsWith("/")?"":"/"}${t.startsWith("/")?t.substring(1):t}`,r.toString()}},93132:(e,t,r)=>{"use strict";var n;r.r(t),r.d(t,{NIL:()=>R,parse:()=>g,stringify:()=>u,v1:()=>f,v3:()=>I,v4:()=>P,v5:()=>T,validate:()=>a,version:()=>C});var o=new Uint8Array(16);function i(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(o)}const s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,a=function(e){return"string"==typeof e&&s.test(e)};for(var c=[],d=0;d<256;++d)c.push((d+256).toString(16).substr(1));const u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase();if(!a(r))throw TypeError("Stringified UUID is invalid");return r};var l,p,h=0,y=0;const f=function(e,t,r){var n=t&&r||0,o=t||new Array(16),s=(e=e||{}).node||l,a=void 0!==e.clockseq?e.clockseq:p;if(null==s||null==a){var c=e.random||(e.rng||i)();null==s&&(s=l=[1|c[0],c[1],c[2],c[3],c[4],c[5]]),null==a&&(a=p=16383&(c[6]<<8|c[7]))}var d=void 0!==e.msecs?e.msecs:Date.now(),f=void 0!==e.nsecs?e.nsecs:y+1,g=d-h+(f-y)/1e4;if(g<0&&void 0===e.clockseq&&(a=a+1&16383),(g<0||d>h)&&void 0===e.nsecs&&(f=0),f>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");h=d,y=f,p=a;var w=(1e4*(268435455&(d+=122192928e5))+f)%4294967296;o[n++]=w>>>24&255,o[n++]=w>>>16&255,o[n++]=w>>>8&255,o[n++]=255&w;var m=d/4294967296*1e4&268435455;o[n++]=m>>>8&255,o[n++]=255&m,o[n++]=m>>>24&15|16,o[n++]=m>>>16&255,o[n++]=a>>>8|128,o[n++]=255&a;for(var S=0;S<6;++S)o[n+S]=s[S];return t||u(o)},g=function(e){if(!a(e))throw TypeError("Invalid UUID");var t,r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r};function w(e,t,r){function n(e,n,o,i){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof n&&(n=g(n)),16!==n.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var s=new Uint8Array(16+e.length);if(s.set(n),s.set(e,n.length),(s=r(s))[6]=15&s[6]|t,s[8]=63&s[8]|128,o){i=i||0;for(var a=0;a<16;++a)o[i+a]=s[a];return o}return u(s)}try{n.name=e}catch(e){}return n.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",n.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",n}function m(e){return 14+(e+64>>>9<<4)+1}function S(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function v(e,t,r,n,o,i){return S((s=S(S(t,e),S(n,i)))<<(a=o)|s>>>32-a,r);var s,a}function E(e,t,r,n,o,i,s){return v(t&r|~t&n,e,t,o,i,s)}function _(e,t,r,n,o,i,s){return v(t&n|r&~n,e,t,o,i,s)}function b(e,t,r,n,o,i,s){return v(t^r^n,e,t,o,i,s)}function A(e,t,r,n,o,i,s){return v(r^(t|~n),e,t,o,i,s)}const I=w("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var r=0;r<t.length;++r)e[r]=t.charCodeAt(r)}return function(e){for(var t=[],r=32*e.length,n="0123456789abcdef",o=0;o<r;o+=8){var i=e[o>>5]>>>o%32&255,s=parseInt(n.charAt(i>>>4&15)+n.charAt(15&i),16);t.push(s)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[m(t)-1]=t;for(var r=1732584193,n=-271733879,o=-1732584194,i=271733878,s=0;s<e.length;s+=16){var a=r,c=n,d=o,u=i;r=E(r,n,o,i,e[s],7,-680876936),i=E(i,r,n,o,e[s+1],12,-389564586),o=E(o,i,r,n,e[s+2],17,606105819),n=E(n,o,i,r,e[s+3],22,-1044525330),r=E(r,n,o,i,e[s+4],7,-176418897),i=E(i,r,n,o,e[s+5],12,1200080426),o=E(o,i,r,n,e[s+6],17,-1473231341),n=E(n,o,i,r,e[s+7],22,-45705983),r=E(r,n,o,i,e[s+8],7,1770035416),i=E(i,r,n,o,e[s+9],12,-1958414417),o=E(o,i,r,n,e[s+10],17,-42063),n=E(n,o,i,r,e[s+11],22,-1990404162),r=E(r,n,o,i,e[s+12],7,1804603682),i=E(i,r,n,o,e[s+13],12,-40341101),o=E(o,i,r,n,e[s+14],17,-1502002290),r=_(r,n=E(n,o,i,r,e[s+15],22,1236535329),o,i,e[s+1],5,-165796510),i=_(i,r,n,o,e[s+6],9,-1069501632),o=_(o,i,r,n,e[s+11],14,643717713),n=_(n,o,i,r,e[s],20,-373897302),r=_(r,n,o,i,e[s+5],5,-701558691),i=_(i,r,n,o,e[s+10],9,38016083),o=_(o,i,r,n,e[s+15],14,-660478335),n=_(n,o,i,r,e[s+4],20,-405537848),r=_(r,n,o,i,e[s+9],5,568446438),i=_(i,r,n,o,e[s+14],9,-1019803690),o=_(o,i,r,n,e[s+3],14,-187363961),n=_(n,o,i,r,e[s+8],20,1163531501),r=_(r,n,o,i,e[s+13],5,-1444681467),i=_(i,r,n,o,e[s+2],9,-51403784),o=_(o,i,r,n,e[s+7],14,1735328473),r=b(r,n=_(n,o,i,r,e[s+12],20,-1926607734),o,i,e[s+5],4,-378558),i=b(i,r,n,o,e[s+8],11,-2022574463),o=b(o,i,r,n,e[s+11],16,1839030562),n=b(n,o,i,r,e[s+14],23,-35309556),r=b(r,n,o,i,e[s+1],4,-1530992060),i=b(i,r,n,o,e[s+4],11,1272893353),o=b(o,i,r,n,e[s+7],16,-155497632),n=b(n,o,i,r,e[s+10],23,-1094730640),r=b(r,n,o,i,e[s+13],4,681279174),i=b(i,r,n,o,e[s],11,-358537222),o=b(o,i,r,n,e[s+3],16,-722521979),n=b(n,o,i,r,e[s+6],23,76029189),r=b(r,n,o,i,e[s+9],4,-640364487),i=b(i,r,n,o,e[s+12],11,-421815835),o=b(o,i,r,n,e[s+15],16,530742520),r=A(r,n=b(n,o,i,r,e[s+2],23,-995338651),o,i,e[s],6,-198630844),i=A(i,r,n,o,e[s+7],10,1126891415),o=A(o,i,r,n,e[s+14],15,-1416354905),n=A(n,o,i,r,e[s+5],21,-57434055),r=A(r,n,o,i,e[s+12],6,1700485571),i=A(i,r,n,o,e[s+3],10,-1894986606),o=A(o,i,r,n,e[s+10],15,-1051523),n=A(n,o,i,r,e[s+1],21,-2054922799),r=A(r,n,o,i,e[s+8],6,1873313359),i=A(i,r,n,o,e[s+15],10,-30611744),o=A(o,i,r,n,e[s+6],15,-1560198380),n=A(n,o,i,r,e[s+13],21,1309151649),r=A(r,n,o,i,e[s+4],6,-145523070),i=A(i,r,n,o,e[s+11],10,-1120210379),o=A(o,i,r,n,e[s+2],15,718787259),n=A(n,o,i,r,e[s+9],21,-343485551),r=S(r,a),n=S(n,c),o=S(o,d),i=S(i,u)}return[r,n,o,i]}(function(e){if(0===e.length)return[];for(var t=8*e.length,r=new Uint32Array(m(t)),n=0;n<t;n+=8)r[n>>5]|=(255&e[n/8])<<n%32;return r}(e),8*e.length))})),P=function(e,t,r){var n=(e=e||{}).random||(e.rng||i)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var o=0;o<16;++o)t[r+o]=n[o];return t}return u(n)};function U(e,t,r,n){switch(e){case 0:return t&r^~t&n;case 1:return t^r^n;case 2:return t&r^t&n^r&n;case 3:return t^r^n}}function k(e,t){return e<<t|e>>>32-t}const T=w("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var n=unescape(encodeURIComponent(e));e=[];for(var o=0;o<n.length;++o)e.push(n.charCodeAt(o))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var i=e.length/4+2,s=Math.ceil(i/16),a=new Array(s),c=0;c<s;++c){for(var d=new Uint32Array(16),u=0;u<16;++u)d[u]=e[64*c+4*u]<<24|e[64*c+4*u+1]<<16|e[64*c+4*u+2]<<8|e[64*c+4*u+3];a[c]=d}a[s-1][14]=8*(e.length-1)/Math.pow(2,32),a[s-1][14]=Math.floor(a[s-1][14]),a[s-1][15]=8*(e.length-1)&4294967295;for(var l=0;l<s;++l){for(var p=new Uint32Array(80),h=0;h<16;++h)p[h]=a[l][h];for(var y=16;y<80;++y)p[y]=k(p[y-3]^p[y-8]^p[y-14]^p[y-16],1);for(var f=r[0],g=r[1],w=r[2],m=r[3],S=r[4],v=0;v<80;++v){var E=Math.floor(v/20),_=k(f,5)+U(E,g,w,m)+S+t[E]+p[v]>>>0;S=m,m=w,w=k(g,30)>>>0,g=f,f=_}r[0]=r[0]+f>>>0,r[1]=r[1]+g>>>0,r[2]=r[2]+w>>>0,r[3]=r[3]+m>>>0,r[4]=r[4]+S>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]})),R="00000000-0000-0000-0000-000000000000",C=function(e){if(!a(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}},82155:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateDpopKeyPair=t.createDpopHeader=void 0;const n=r(60991),o=r(38908),i=r(34672);function s(e){const t=new URL(e);return t.hash="",t.username="",t.password="",t.toString()}t.createDpopHeader=async function(e,t,r){return new n.SignJWT({htu:s(e),htm:t.toUpperCase(),jti:o.v4()}).setProtectedHeader({alg:i.PREFERRED_SIGNING_ALG[0],jwk:r.publicKey,typ:"dpop+jwt"}).setIssuedAt().sign(r.privateKey,{})},t.generateDpopKeyPair=async function(){const{privateKey:e,publicKey:t}=await n.generateKeyPair(i.PREFERRED_SIGNING_ALG[0]),r={privateKey:e,publicKey:await n.fromKeyLike(t)};return[r.publicKey.alg]=i.PREFERRED_SIGNING_ALG,r}},18687:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.buildAuthenticatedFetch=t.DEFAULT_EXPIRATION_TIME_SECONDS=void 0;const n=r(34672),o=r(82155),i=r(46904),s=r(96583);async function a(e,t,r,n,i){return e(r,await async function(e,t,r,n){return void 0!==r?async function(e,t,r,n){var i;const s={...n};return s.headers={...null==n?void 0:n.headers,Authorization:`DPoP ${t}`,DPoP:await o.createDpopHeader(e,null!==(i=null==n?void 0:n.method)&&void 0!==i?i:"get",r)},s}(e,t,r,n):{...n,headers:{...null==n?void 0:n.headers,Authorization:`Bearer ${t}`}}}(r.toString(),t,i,n))}t.DEFAULT_EXPIRATION_TIME_SECONDS=600;const c=e=>void 0!==e?e-n.REFRESH_BEFORE_EXPIRATION_SECONDS>0?e-n.REFRESH_BEFORE_EXPIRATION_SECONDS:e:t.DEFAULT_EXPIRATION_TIME_SECONDS;t.buildAuthenticatedFetch=async function(e,r,o){var d;let u,l=r;const p=null==o?void 0:o.refreshOptions;if(void 0!==p){const e=async()=>{var r,a,d,h;try{const{accessToken:i,refreshToken:s,expiresIn:a}=await async function(e,r,o){var i;const s=await e.tokenRefresher.refresh(e.sessionId,e.refreshToken,r);return null==o||o.emit(n.EVENTS.SESSION_EXTENDED,null!==(i=s.expiresIn)&&void 0!==i?i:t.DEFAULT_EXPIRATION_TIME_SECONDS),"string"==typeof s.refreshToken&&(null==o||o.emit(n.EVENTS.NEW_REFRESH_TOKEN,s.refreshToken)),{accessToken:s.accessToken,refreshToken:s.refreshToken,expiresIn:s.expiresIn}}(p,o.dpopKey,o.eventEmitter);l=i,void 0!==s&&(p.refreshToken=s),clearTimeout(u),u=setTimeout(e,1e3*c(a)),null===(r=o.eventEmitter)||void 0===r||r.emit(n.EVENTS.TIMEOUT_SET,u)}catch(e){e instanceof i.OidcProviderError&&(null===(a=null==o?void 0:o.eventEmitter)||void 0===a||a.emit(n.EVENTS.ERROR,e.error,e.errorDescription),null===(d=null==o?void 0:o.eventEmitter)||void 0===d||d.emit(n.EVENTS.SESSION_EXPIRED)),e instanceof s.InvalidResponseError&&e.missingFields.includes("access_token")&&(null===(h=null==o?void 0:o.eventEmitter)||void 0===h||h.emit(n.EVENTS.SESSION_EXPIRED))}};u=setTimeout(e,1e3*c(o.expiresIn)),null===(d=o.eventEmitter)||void 0===d||d.emit(n.EVENTS.TIMEOUT_SET,u)}else if(void 0!==o&&void 0!==o.eventEmitter){const e=setTimeout((()=>{o.eventEmitter.emit(n.EVENTS.SESSION_EXPIRED)}),1e3*c(o.expiresIn));o.eventEmitter.emit(n.EVENTS.TIMEOUT_SET,e)}return async(t,r)=>{let n=await a(e,l,t,r,null==o?void 0:o.dpopKey);const i=!n.ok&&(s=n.status,![401,403].includes(s));var s;return n.ok||i||n.url!==t&&void 0!==(null==o?void 0:o.dpopKey)&&(n=await a(e,l,n.url,r,o.dpopKey)),n}}},34672:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REFRESH_BEFORE_EXPIRATION_SECONDS=t.EVENTS=t.PREFERRED_SIGNING_ALG=t.SOLID_CLIENT_AUTHN_KEY_PREFIX=void 0,t.SOLID_CLIENT_AUTHN_KEY_PREFIX="solidClientAuthn:",t.PREFERRED_SIGNING_ALG=["ES256","RS256"],t.EVENTS={NEW_REFRESH_TOKEN:"newRefreshToken",ERROR:"onError",SESSION_EXPIRED:"sessionExpired",SESSION_EXTENDED:"sessionExtended",TIMEOUT_SET:"timeoutSet"},t.REFRESH_BEFORE_EXPIRATION_SECONDS=5},17117:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r extends Error{constructor(e){super(e)}}t.default=r},32029:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r extends Error{constructor(e,t,n=!0){super("string"==typeof e?r.substituteParams(e,t):r.appendErrorIri(r.lookupErrorIri(e,t),e,n))}httpResponse(e,t=!0){return this.message=r.appendHttpResponseDetails(this.message,e,t),this.httpErrorResponse=e,this}hasHttpResponse(){return void 0!==this.httpErrorResponse}getHttpResponse(){return this.httpErrorResponse}getHttpStatusCode(){if(void 0===this.httpErrorResponse)throw new r("This InruptError was not provided with a HTTP response - so we can't get its HTTP Status Code.");return this.httpErrorResponse.status}getHttpStatusText(){if(void 0===this.httpErrorResponse)throw new r("This InruptError was not provided with a HTTP response - so we can't get its HTTP Status Text!");return this.httpErrorResponse.statusText}static determineIfVocabTerm(e){return void 0!==e.strict}static lookupErrorIri(e,t){if(r.determineIfVocabTerm(e)){const r=void 0===t?e.message:e.messageParams(...t);return void 0===r?`Looked up error message IRI [${e.value}], but found no message value.`:r}return`Error message looked up at: [${e.value}]${void 0===t?"":`, with params [${t.toString()}]`}`}static appendHttpResponseDetails(e,t,r){return r&&void 0!==t?`${e} HTTP details: status code [${t.status}], status text [${t.statusText}].`:e}static appendErrorIri(e,t,r){return r?`${e} Error IRI: [${t.value}].`:e}static substituteParams(e,t){let r=e;if(void 0!==t){const n=e.split("{{").length-1;if(n!==t.length)throw new Error(`Setting parameters on message [${e}], but it requires [${n}] params and we received [${t.length}].`);for(let e=0;e<t.length;e+=1){const n=`{{${e}}}`;r=r.replace(n,t[e])}}return r}}t.default=r},96583:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidResponseError=void 0;class r extends Error{constructor(e){super(`Invalid response from OIDC provider: missing fields ${e}`),this.missingFields=e}}t.InvalidResponseError=r},47073:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r extends Error{constructor(e){super(`[${e}] is not implemented`)}}t.default=r},46904:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OidcProviderError=void 0;class r extends Error{constructor(e,t,r){super(e),this.error=t,this.errorDescription=r}}t.OidcProviderError=r},80835:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.StorageUtilityGetResponse=t.StorageUtilityMock=t.mockStorageUtility=t.mockStorage=t.buildAuthenticatedFetch=t.generateDpopKeyPair=t.createDpopHeader=t.OidcProviderError=t.InvalidResponseError=t.NotImplementedError=t.ConfigurationError=t.InMemoryStorage=t.getSessionIdFromOauthState=t.saveSessionInfoToStorage=t.loadOidcContextFromStorage=t.StorageUtility=t.determineSigningAlg=t.handleRegistration=t.USER_SESSION_PREFIX=t.isSupportedTokenType=t.fetchJwks=t.getWebidFromTokenPayload=t.AggregateHandler=void 0,o(r(34672),t);var s=r(95024);Object.defineProperty(t,"AggregateHandler",{enumerable:!0,get:function(){return i(s).default}});var a=r(33528);Object.defineProperty(t,"getWebidFromTokenPayload",{enumerable:!0,get:function(){return a.getWebidFromTokenPayload}}),Object.defineProperty(t,"fetchJwks",{enumerable:!0,get:function(){return a.fetchJwks}});var c=r(31168);Object.defineProperty(t,"isSupportedTokenType",{enumerable:!0,get:function(){return c.isSupportedTokenType}});var d=r(81645);Object.defineProperty(t,"USER_SESSION_PREFIX",{enumerable:!0,get:function(){return d.USER_SESSION_PREFIX}});var u=r(74725);Object.defineProperty(t,"handleRegistration",{enumerable:!0,get:function(){return u.handleRegistration}}),Object.defineProperty(t,"determineSigningAlg",{enumerable:!0,get:function(){return u.determineSigningAlg}});var l=r(4574);Object.defineProperty(t,"StorageUtility",{enumerable:!0,get:function(){return i(l).default}}),Object.defineProperty(t,"loadOidcContextFromStorage",{enumerable:!0,get:function(){return l.loadOidcContextFromStorage}}),Object.defineProperty(t,"saveSessionInfoToStorage",{enumerable:!0,get:function(){return l.saveSessionInfoToStorage}}),Object.defineProperty(t,"getSessionIdFromOauthState",{enumerable:!0,get:function(){return l.getSessionIdFromOauthState}});var p=r(12244);Object.defineProperty(t,"InMemoryStorage",{enumerable:!0,get:function(){return i(p).default}});var h=r(17117);Object.defineProperty(t,"ConfigurationError",{enumerable:!0,get:function(){return i(h).default}});var y=r(47073);Object.defineProperty(t,"NotImplementedError",{enumerable:!0,get:function(){return i(y).default}});var f=r(96583);Object.defineProperty(t,"InvalidResponseError",{enumerable:!0,get:function(){return f.InvalidResponseError}});var g=r(46904);Object.defineProperty(t,"OidcProviderError",{enumerable:!0,get:function(){return g.OidcProviderError}});var w=r(82155);Object.defineProperty(t,"createDpopHeader",{enumerable:!0,get:function(){return w.createDpopHeader}}),Object.defineProperty(t,"generateDpopKeyPair",{enumerable:!0,get:function(){return w.generateDpopKeyPair}});var m=r(18687);Object.defineProperty(t,"buildAuthenticatedFetch",{enumerable:!0,get:function(){return m.buildAuthenticatedFetch}});var S=r(77478);Object.defineProperty(t,"mockStorage",{enumerable:!0,get:function(){return S.mockStorage}}),Object.defineProperty(t,"mockStorageUtility",{enumerable:!0,get:function(){return S.mockStorageUtility}}),Object.defineProperty(t,"StorageUtilityMock",{enumerable:!0,get:function(){return S.StorageUtilityMock}}),Object.defineProperty(t,"StorageUtilityGetResponse",{enumerable:!0,get:function(){return S.StorageUtilityGetResponse}})},74725:(e,t)=>{"use strict";function r(e){try{return new URL(e),!0}catch(e){return!1}}Object.defineProperty(t,"__esModule",{value:!0}),t.handleRegistration=t.determineSigningAlg=void 0,t.determineSigningAlg=function(e,t){var r;return null!==(r=t.find((t=>e.includes(t))))&&void 0!==r?r:null},t.handleRegistration=async function(e,t,n,o){const i=function(e,t){return void 0===e.clientId||r(e.clientId)?"https://solidproject.org/TR/solid-oidc"===t.solidOidcSupported&&void 0!==e.clientId&&r(e.clientId)?"solid-oidc":"dynamic":"static"}(e,t);return"dynamic"===i?o.getClient({sessionId:e.sessionId,clientName:e.clientName,redirectUrl:e.redirectUrl},t):(await n.setForUser(e.sessionId,{clientId:e.clientId}),e.clientSecret&&await n.setForUser(e.sessionId,{clientSecret:e.clientSecret}),e.clientName&&await n.setForUser(e.sessionId,{clientName:e.clientName}),{clientId:e.clientId,clientSecret:e.clientSecret,clientName:e.clientName,clientType:i})}},33528:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWebidFromTokenPayload=t.fetchJwks=void 0;const n=r(54098),o=r(60991);async function i(e,t){const r=await n.fetch(e);if(200!==r.status)throw new Error(`Could not fetch JWKS for [${t}] at [${e}]: ${r.status} ${r.statusText}`);let o;try{o=(await r.json()).keys[0]}catch(r){throw new Error(`Malformed JWKS for [${t}] at [${e}]: ${r.message}`)}return o}t.fetchJwks=i,t.getWebidFromTokenPayload=async function(e,t,r,n){const s=await i(t,r);let a;try{const{payload:t}=await o.jwtVerify(e,await o.parseJwk(s),{issuer:r,audience:n});a=t}catch(e){throw new Error(`ID token verification failed: ${e.stack}`)}if("string"==typeof a.webid)return a.webid;if("string"!=typeof a.sub)throw new Error(`The ID token ${JSON.stringify(a)} is invalid: it has no 'webid' claim and no 'sub' claim.`);try{return new URL(a.sub),a.sub}catch(e){throw new Error(`The ID token has no 'webid' claim, and its 'sub' claim of [${a.sub}] is invalid as a URL - error [${e}].`)}}},31168:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSupportedTokenType=void 0,t.isSupportedTokenType=function(e){return"string"==typeof e&&["DPoP","Bearer"].includes(e)}},81645:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USER_SESSION_PREFIX=void 0,t.USER_SESSION_PREFIX="solidClientAuthenticationUser"},12244:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.map={}}async get(e){return this.map[e]||void 0}async set(e,t){this.map[e]=t}async delete(e){delete this.map[e]}}},4574:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.saveSessionInfoToStorage=t.loadOidcContextFromStorage=t.getSessionIdFromOauthState=void 0;const o=r(60991),i=n(r(32029));t.getSessionIdFromOauthState=async function(e,t){return e.getForUser(t,"sessionId")},t.loadOidcContextFromStorage=async function(e,t,r){try{const[n,o,i,s]=await Promise.all([t.getForUser(e,"issuer",{errorIfNull:!0}),t.getForUser(e,"codeVerifier"),t.getForUser(e,"redirectUrl"),t.getForUser(e,"dpop",{errorIfNull:!0})]);return{codeVerifier:o,redirectUrl:i,issuerConfig:await r.fetchConfig(n),dpop:"true"===s}}catch(t){throw new Error(`Failed to retrieve OIDC context from storage associated with session [${e}]: ${t.toString()}`)}},t.saveSessionInfoToStorage=async function(e,t,r,n,i,s,a,c){void 0!==s&&await e.setForUser(t,{refreshToken:s},{secure:a}),void 0!==r&&await e.setForUser(t,{idToken:r},{secure:a}),void 0!==n&&await e.setForUser(t,{webId:n},{secure:a}),void 0!==i&&await e.setForUser(t,{isLoggedIn:i},{secure:a}),void 0!==c&&await e.setForUser(t,{publicKey:JSON.stringify(c.publicKey),privateKey:JSON.stringify(await o.fromKeyLike(c.privateKey))},{secure:a})},t.default=class{constructor(e,t){this.secureStorage=e,this.insecureStorage=t,this.RESOURCE_SERVER_SESSION_INFORMATION_KEY="tmp-resource-server-session-info"}getKey(e){return`solidClientAuthenticationUser:${e}`}async getUserData(e,t){const r=await(t?this.secureStorage:this.insecureStorage).get(this.getKey(e));if(void 0===r)return{};try{return JSON.parse(r)}catch(n){throw new i.default(`Data for user [${e}] in [${t?"secure":"unsecure"}] storage is corrupted - expected valid JSON, but got: ${r}`)}}async setUserData(e,t,r){await(r?this.secureStorage:this.insecureStorage).set(this.getKey(e),JSON.stringify(t))}async get(e,t){const r=await((null==t?void 0:t.secure)?this.secureStorage:this.insecureStorage).get(e);if(void 0===r&&(null==t?void 0:t.errorIfNull))throw new i.default(`[${e}] is not stored`);return r}async set(e,t,r){return((null==r?void 0:r.secure)?this.secureStorage:this.insecureStorage).set(e,t)}async delete(e,t){return((null==t?void 0:t.secure)?this.secureStorage:this.insecureStorage).delete(e)}async getForUser(e,t,r){const n=await this.getUserData(e,null==r?void 0:r.secure);let o;if(n&&n[t]||(o=void 0),o=n[t],void 0===o&&(null==r?void 0:r.errorIfNull))throw new i.default(`Field [${t}] for user [${e}] is not stored`);return o||void 0}async setForUser(e,t,r){let n;try{n=await this.getUserData(e,null==r?void 0:r.secure)}catch(e){n={}}await this.setUserData(e,{...n,...t},null==r?void 0:r.secure)}async deleteForUser(e,t,r){const n=await this.getUserData(e,null==r?void 0:r.secure);delete n[t],await this.setUserData(e,n,null==r?void 0:r.secure)}async deleteAllUserData(e,t){await((null==t?void 0:t.secure)?this.secureStorage:this.insecureStorage).delete(this.getKey(e))}async storeResourceServerSessionInfo(e,t,r){var n;const o=JSON.parse(null!==(n=await this.insecureStorage.get(this.RESOURCE_SERVER_SESSION_INFORMATION_KEY))&&void 0!==n?n:"{}");o.webId!==e&&(o.sessions={}),o.webId=e,o.sessions[t]={expiration:r},await this.insecureStorage.set(this.RESOURCE_SERVER_SESSION_INFORMATION_KEY,JSON.stringify(o))}async clearResourceServerSessionInfo(e){var t;const r=JSON.parse(null!==(t=await this.insecureStorage.get(this.RESOURCE_SERVER_SESSION_INFORMATION_KEY))&&void 0!==t?t:"{}");void 0!==r.sessions&&(delete r.sessions[e],0===Object.keys(r.sessions).length?await this.insecureStorage.set(this.RESOURCE_SERVER_SESSION_INFORMATION_KEY,"{}"):await this.insecureStorage.set(this.RESOURCE_SERVER_SESSION_INFORMATION_KEY,JSON.stringify(r)))}}},77478:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mockStorageUtility=t.mockStorage=t.StorageUtilityMock=t.StorageUtilityGetResponse=void 0;const n=r(80835);t.StorageUtilityGetResponse="getResponse",t.StorageUtilityMock={get:async(e,r)=>t.StorageUtilityGetResponse,set:async(e,t)=>{},delete:async e=>{},getForUser:async(e,r,n)=>t.StorageUtilityGetResponse,setForUser:async(e,t,r)=>{},deleteForUser:async(e,t,r)=>{},deleteAllUserData:async(e,t)=>{},storeResourceServerSessionInfo:async(e,t,r)=>{},clearResourceServerSessionInfo:async e=>{}},t.mockStorage=e=>{const t=e;return{get:async e=>{if(void 0!==t[e])return"string"==typeof t[e]?t[e]:JSON.stringify(t[e])},set:async(e,r)=>{t[e]=r},delete:async e=>{delete t[e]}}},t.mockStorageUtility=(e,r=!1)=>r?new n.StorageUtility(t.mockStorage(e),t.mockStorage({})):new n.StorageUtility(t.mockStorage({}),t.mockStorage(e))},95024:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(32029));t.default=class{constructor(e){this.handleables=e}async getProperHandler(e){const t=await Promise.all(this.handleables.map((t=>t.canHandle(...e))));for(let e=0;e<t.length;e+=1)if(t[e])return this.handleables[e];return null}async canHandle(...e){return null!==await this.getProperHandler(e)}async handle(...e){const t=await this.getProperHandler(e);if(t)return t.handle(...e);throw new o.default(`[${this.constructor.name}] cannot find a suitable handler for: ${e.map((e=>{try{return JSON.stringify(e)}catch(t){return e.toString()}})).join(", ")}`)}}},38908:(e,t,r)=>{"use strict";var n;r.r(t),r.d(t,{NIL:()=>R,parse:()=>g,stringify:()=>u,v1:()=>f,v3:()=>I,v4:()=>P,v5:()=>T,validate:()=>a,version:()=>C});var o=new Uint8Array(16);function i(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(o)}const s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,a=function(e){return"string"==typeof e&&s.test(e)};for(var c=[],d=0;d<256;++d)c.push((d+256).toString(16).substr(1));const u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase();if(!a(r))throw TypeError("Stringified UUID is invalid");return r};var l,p,h=0,y=0;const f=function(e,t,r){var n=t&&r||0,o=t||new Array(16),s=(e=e||{}).node||l,a=void 0!==e.clockseq?e.clockseq:p;if(null==s||null==a){var c=e.random||(e.rng||i)();null==s&&(s=l=[1|c[0],c[1],c[2],c[3],c[4],c[5]]),null==a&&(a=p=16383&(c[6]<<8|c[7]))}var d=void 0!==e.msecs?e.msecs:Date.now(),f=void 0!==e.nsecs?e.nsecs:y+1,g=d-h+(f-y)/1e4;if(g<0&&void 0===e.clockseq&&(a=a+1&16383),(g<0||d>h)&&void 0===e.nsecs&&(f=0),f>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");h=d,y=f,p=a;var w=(1e4*(268435455&(d+=122192928e5))+f)%4294967296;o[n++]=w>>>24&255,o[n++]=w>>>16&255,o[n++]=w>>>8&255,o[n++]=255&w;var m=d/4294967296*1e4&268435455;o[n++]=m>>>8&255,o[n++]=255&m,o[n++]=m>>>24&15|16,o[n++]=m>>>16&255,o[n++]=a>>>8|128,o[n++]=255&a;for(var S=0;S<6;++S)o[n+S]=s[S];return t||u(o)},g=function(e){if(!a(e))throw TypeError("Invalid UUID");var t,r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r};function w(e,t,r){function n(e,n,o,i){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof n&&(n=g(n)),16!==n.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var s=new Uint8Array(16+e.length);if(s.set(n),s.set(e,n.length),(s=r(s))[6]=15&s[6]|t,s[8]=63&s[8]|128,o){i=i||0;for(var a=0;a<16;++a)o[i+a]=s[a];return o}return u(s)}try{n.name=e}catch(e){}return n.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",n.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",n}function m(e){return 14+(e+64>>>9<<4)+1}function S(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function v(e,t,r,n,o,i){return S((s=S(S(t,e),S(n,i)))<<(a=o)|s>>>32-a,r);var s,a}function E(e,t,r,n,o,i,s){return v(t&r|~t&n,e,t,o,i,s)}function _(e,t,r,n,o,i,s){return v(t&n|r&~n,e,t,o,i,s)}function b(e,t,r,n,o,i,s){return v(t^r^n,e,t,o,i,s)}function A(e,t,r,n,o,i,s){return v(r^(t|~n),e,t,o,i,s)}const I=w("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var r=0;r<t.length;++r)e[r]=t.charCodeAt(r)}return function(e){for(var t=[],r=32*e.length,n="0123456789abcdef",o=0;o<r;o+=8){var i=e[o>>5]>>>o%32&255,s=parseInt(n.charAt(i>>>4&15)+n.charAt(15&i),16);t.push(s)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[m(t)-1]=t;for(var r=1732584193,n=-271733879,o=-1732584194,i=271733878,s=0;s<e.length;s+=16){var a=r,c=n,d=o,u=i;r=E(r,n,o,i,e[s],7,-680876936),i=E(i,r,n,o,e[s+1],12,-389564586),o=E(o,i,r,n,e[s+2],17,606105819),n=E(n,o,i,r,e[s+3],22,-1044525330),r=E(r,n,o,i,e[s+4],7,-176418897),i=E(i,r,n,o,e[s+5],12,1200080426),o=E(o,i,r,n,e[s+6],17,-1473231341),n=E(n,o,i,r,e[s+7],22,-45705983),r=E(r,n,o,i,e[s+8],7,1770035416),i=E(i,r,n,o,e[s+9],12,-1958414417),o=E(o,i,r,n,e[s+10],17,-42063),n=E(n,o,i,r,e[s+11],22,-1990404162),r=E(r,n,o,i,e[s+12],7,1804603682),i=E(i,r,n,o,e[s+13],12,-40341101),o=E(o,i,r,n,e[s+14],17,-1502002290),r=_(r,n=E(n,o,i,r,e[s+15],22,1236535329),o,i,e[s+1],5,-165796510),i=_(i,r,n,o,e[s+6],9,-1069501632),o=_(o,i,r,n,e[s+11],14,643717713),n=_(n,o,i,r,e[s],20,-373897302),r=_(r,n,o,i,e[s+5],5,-701558691),i=_(i,r,n,o,e[s+10],9,38016083),o=_(o,i,r,n,e[s+15],14,-660478335),n=_(n,o,i,r,e[s+4],20,-405537848),r=_(r,n,o,i,e[s+9],5,568446438),i=_(i,r,n,o,e[s+14],9,-1019803690),o=_(o,i,r,n,e[s+3],14,-187363961),n=_(n,o,i,r,e[s+8],20,1163531501),r=_(r,n,o,i,e[s+13],5,-1444681467),i=_(i,r,n,o,e[s+2],9,-51403784),o=_(o,i,r,n,e[s+7],14,1735328473),r=b(r,n=_(n,o,i,r,e[s+12],20,-1926607734),o,i,e[s+5],4,-378558),i=b(i,r,n,o,e[s+8],11,-2022574463),o=b(o,i,r,n,e[s+11],16,1839030562),n=b(n,o,i,r,e[s+14],23,-35309556),r=b(r,n,o,i,e[s+1],4,-1530992060),i=b(i,r,n,o,e[s+4],11,1272893353),o=b(o,i,r,n,e[s+7],16,-155497632),n=b(n,o,i,r,e[s+10],23,-1094730640),r=b(r,n,o,i,e[s+13],4,681279174),i=b(i,r,n,o,e[s],11,-358537222),o=b(o,i,r,n,e[s+3],16,-722521979),n=b(n,o,i,r,e[s+6],23,76029189),r=b(r,n,o,i,e[s+9],4,-640364487),i=b(i,r,n,o,e[s+12],11,-421815835),o=b(o,i,r,n,e[s+15],16,530742520),r=A(r,n=b(n,o,i,r,e[s+2],23,-995338651),o,i,e[s],6,-198630844),i=A(i,r,n,o,e[s+7],10,1126891415),o=A(o,i,r,n,e[s+14],15,-1416354905),n=A(n,o,i,r,e[s+5],21,-57434055),r=A(r,n,o,i,e[s+12],6,1700485571),i=A(i,r,n,o,e[s+3],10,-1894986606),o=A(o,i,r,n,e[s+10],15,-1051523),n=A(n,o,i,r,e[s+1],21,-2054922799),r=A(r,n,o,i,e[s+8],6,1873313359),i=A(i,r,n,o,e[s+15],10,-30611744),o=A(o,i,r,n,e[s+6],15,-1560198380),n=A(n,o,i,r,e[s+13],21,1309151649),r=A(r,n,o,i,e[s+4],6,-145523070),i=A(i,r,n,o,e[s+11],10,-1120210379),o=A(o,i,r,n,e[s+2],15,718787259),n=A(n,o,i,r,e[s+9],21,-343485551),r=S(r,a),n=S(n,c),o=S(o,d),i=S(i,u)}return[r,n,o,i]}(function(e){if(0===e.length)return[];for(var t=8*e.length,r=new Uint32Array(m(t)),n=0;n<t;n+=8)r[n>>5]|=(255&e[n/8])<<n%32;return r}(e),8*e.length))})),P=function(e,t,r){var n=(e=e||{}).random||(e.rng||i)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var o=0;o<16;++o)t[r+o]=n[o];return t}return u(n)};function U(e,t,r,n){switch(e){case 0:return t&r^~t&n;case 1:return t^r^n;case 2:return t&r^t&n^r&n;case 3:return t^r^n}}function k(e,t){return e<<t|e>>>32-t}const T=w("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var n=unescape(encodeURIComponent(e));e=[];for(var o=0;o<n.length;++o)e.push(n.charCodeAt(o))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var i=e.length/4+2,s=Math.ceil(i/16),a=new Array(s),c=0;c<s;++c){for(var d=new Uint32Array(16),u=0;u<16;++u)d[u]=e[64*c+4*u]<<24|e[64*c+4*u+1]<<16|e[64*c+4*u+2]<<8|e[64*c+4*u+3];a[c]=d}a[s-1][14]=8*(e.length-1)/Math.pow(2,32),a[s-1][14]=Math.floor(a[s-1][14]),a[s-1][15]=8*(e.length-1)&4294967295;for(var l=0;l<s;++l){for(var p=new Uint32Array(80),h=0;h<16;++h)p[h]=a[l][h];for(var y=16;y<80;++y)p[y]=k(p[y-3]^p[y-8]^p[y-14]^p[y-16],1);for(var f=r[0],g=r[1],w=r[2],m=r[3],S=r[4],v=0;v<80;++v){var E=Math.floor(v/20),_=k(f,5)+U(E,g,w,m)+S+t[E]+p[v]>>>0;S=m,m=w,w=k(g,30)>>>0,g=f,f=_}r[0]=r[0]+f>>>0,r[1]=r[1]+g>>>0,r[2]=r[2]+w>>>0,r[3]=r[3]+m>>>0,r[4]=r[4]+S>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]})),R="00000000-0000-0000-0000-000000000000",C=function(e){if(!a(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}},54098:function(e,t){var r="undefined"!=typeof self?self:this,n=function(){function e(){this.fetch=!1,this.DOMException=r.DOMException}return e.prototype=r,new e}();!function(e){!function(t){var r="URLSearchParams"in e,n="Symbol"in e&&"iterator"in Symbol,o="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),i="FormData"in e,s="ArrayBuffer"in e;if(s)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],c=ArrayBuffer.isView||function(e){return e&&a.indexOf(Object.prototype.toString.call(e))>-1};function d(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function u(e){return"string"!=typeof e&&(e=String(e)),e}function l(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function p(e){this.map={},e instanceof p?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function h(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function y(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function f(e){var t=new FileReader,r=y(t);return t.readAsArrayBuffer(e),r}function g(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function w(){return this.bodyUsed=!1,this._initBody=function(e){var t;this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:o&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:i&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:r&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():s&&o&&(t=e)&&DataView.prototype.isPrototypeOf(t)?(this._bodyArrayBuffer=g(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s&&(ArrayBuffer.prototype.isPrototypeOf(e)||c(e))?this._bodyArrayBuffer=g(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},o&&(this.blob=function(){var e=h(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?h(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(f)}),this.text=function(){var e,t,r,n=h(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,r=y(t=new FileReader),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(v)}),this.json=function(){return this.text().then(JSON.parse)},this}p.prototype.append=function(e,t){e=d(e),t=u(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},p.prototype.delete=function(e){delete this.map[d(e)]},p.prototype.get=function(e){return e=d(e),this.has(e)?this.map[e]:null},p.prototype.has=function(e){return this.map.hasOwnProperty(d(e))},p.prototype.set=function(e,t){this.map[d(e)]=u(t)},p.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},p.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),l(e)},p.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),l(e)},p.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),l(e)},n&&(p.prototype[Symbol.iterator]=p.prototype.entries);var m=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function S(e,t){var r,n,o=(t=t||{}).body;if(e instanceof S){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new p(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,o||null==e._bodyInit||(o=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new p(t.headers)),this.method=(n=(r=t.method||this.method||"GET").toUpperCase(),m.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(o)}function v(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),o=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(o))}})),t}function E(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new p(t.headers),this.url=t.url||"",this._initBody(e)}S.prototype.clone=function(){return new S(this,{body:this._bodyInit})},w.call(S.prototype),w.call(E.prototype),E.prototype.clone=function(){return new E(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new p(this.headers),url:this.url})},E.error=function(){var e=new E(null,{status:0,statusText:""});return e.type="error",e};var _=[301,302,303,307,308];E.redirect=function(e,t){if(-1===_.indexOf(t))throw new RangeError("Invalid status code");return new E(null,{status:t,headers:{location:e}})},t.DOMException=e.DOMException;try{new t.DOMException}catch(e){t.DOMException=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function b(e,r){return new Promise((function(n,i){var s=new S(e,r);if(s.signal&&s.signal.aborted)return i(new t.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function c(){a.abort()}a.onload=function(){var e,t,r={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new p,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var o=r.join(":").trim();t.append(n,o)}})),t)};r.url="responseURL"in a?a.responseURL:r.headers.get("X-Request-URL");var o="response"in a?a.response:a.responseText;n(new E(o,r))},a.onerror=function(){i(new TypeError("Network request failed"))},a.ontimeout=function(){i(new TypeError("Network request failed"))},a.onabort=function(){i(new t.DOMException("Aborted","AbortError"))},a.open(s.method,s.url,!0),"include"===s.credentials?a.withCredentials=!0:"omit"===s.credentials&&(a.withCredentials=!1),"responseType"in a&&o&&(a.responseType="blob"),s.headers.forEach((function(e,t){a.setRequestHeader(t,e)})),s.signal&&(s.signal.addEventListener("abort",c),a.onreadystatechange=function(){4===a.readyState&&s.signal.removeEventListener("abort",c)}),a.send(void 0===s._bodyInit?null:s._bodyInit)}))}b.polyfill=!0,e.fetch||(e.fetch=b,e.Headers=p,e.Request=S,e.Response=E),t.Headers=p,t.Request=S,t.Response=E,t.fetch=b,Object.defineProperty(t,"__esModule",{value:!0})}({})}(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var o=n;(t=o.fetch).default=o.fetch,t.fetch=o.fetch,t.Headers=o.Headers,t.Request=o.Request,t.Response=o.Response,e.exports=t}}]);